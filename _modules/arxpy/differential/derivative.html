

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>arxpy.differential.derivative &mdash; ArxPy 0.2.alpha documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> ArxPy
          

          
          </a>

          
            
            
              <div class="version">
                0.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../arxpy.html">arxpy package</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">ArxPy</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>arxpy.differential.derivative</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for arxpy.differential.derivative</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Manipulate derivatives of bit-vector operations.&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">collections</span>
<span class="kn">import</span> <span class="nn">functools</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">operator</span>
<span class="kn">import</span> <span class="nn">fractions</span>

<span class="kn">from</span> <span class="nn">arxpy.bitvector</span> <span class="kn">import</span> <span class="n">core</span>
<span class="kn">from</span> <span class="nn">arxpy.bitvector</span> <span class="kn">import</span> <span class="n">operation</span>
<span class="kn">from</span> <span class="nn">arxpy.bitvector</span> <span class="kn">import</span> <span class="n">extraop</span>

<span class="kn">from</span> <span class="nn">arxpy.differential</span> <span class="kn">import</span> <span class="n">difference</span>


<span class="k">def</span> <span class="nf">_tuplify</span><span class="p">(</span><span class="n">seq</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Sequence</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">seq</span><span class="p">])</span>


<div class="viewcode-block" id="Derivative"><a class="viewcode-back" href="../../../arxpy.differential.derivative.html#arxpy.differential.derivative.Derivative">[docs]</a><span class="k">class</span> <span class="nc">Derivative</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Represent derivatives of bit-vector operations.</span>

<span class="sd">    Given a `Difference` operation :math:`-`  and its inverse :math:`+`,</span>
<span class="sd">    the derivative of an `Operation` :math:`f`</span>
<span class="sd">    at the input difference :math:`\\alpha` is defined as</span>
<span class="sd">    :math:`f_{\\alpha} (x) = f(x + \\alpha) - f(x)`</span>
<span class="sd">    (see also `Difference.derivative`).</span>

<span class="sd">    .. note:: Derivatives of functions with scalar args are not supported.</span>

<span class="sd">    This class is not meant to be instantiated but to provide a base</span>
<span class="sd">    class for creating derivatives.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        diff_type: the type of `Difference`</span>
<span class="sd">        op: the bit-vector `Operation` :math:`f`</span>
<span class="sd">        input_diff: a list containing the `Difference` of each bit-vector</span>
<span class="sd">            operand.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">diff_type</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="c1"># op  # some subclasses need this attribute as an object (not class) attribute</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_diff</span><span class="p">):</span>  <span class="c1"># noqa: 102</span>
        <span class="n">input_diff</span> <span class="o">=</span> <span class="n">_tuplify</span><span class="p">(</span><span class="n">input_diff</span><span class="p">)</span>

        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">op</span><span class="o">.</span><span class="n">arity</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span>  <span class="c1"># no scalars</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">input_diff</span><span class="p">)</span> <span class="o">==</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">op</span><span class="o">.</span><span class="n">arity</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">all</span><span class="p">((</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">diff_type</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">input_diff</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">input_diff</span> <span class="o">=</span> <span class="n">input_diff</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">{}{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_diff</span><span class="p">)</span>

    <span class="fm">__repr__</span> <span class="o">=</span> <span class="fm">__str__</span>

<div class="viewcode-block" id="Derivative.eval"><a class="viewcode-back" href="../../../arxpy.differential.derivative.html#arxpy.differential.derivative.Derivative.eval">[docs]</a>    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Evaluate the derivative at :math:`x`.</span>

<span class="sd">        Return:</span>
<span class="sd">            `Difference`: the corresponding output difference</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">core</span><span class="o">.</span><span class="n">Term</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">f_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op</span><span class="p">(</span><span class="o">*</span><span class="n">x</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">a_i</span><span class="o">.</span><span class="n">get_pair_element</span><span class="p">(</span><span class="n">x_i</span><span class="p">)</span> <span class="k">for</span> <span class="n">x_i</span><span class="p">,</span> <span class="n">a_i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_diff</span><span class="p">)]</span>
        <span class="n">f_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op</span><span class="p">(</span><span class="o">*</span><span class="n">y</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">diff_type</span><span class="o">.</span><span class="n">from_pair</span><span class="p">(</span><span class="n">f_x</span><span class="p">,</span> <span class="n">f_y</span><span class="p">)</span></div>

<div class="viewcode-block" id="Derivative.is_possible"><a class="viewcode-back" href="../../../arxpy.differential.derivative.html#arxpy.differential.derivative.Derivative.is_possible">[docs]</a>    <span class="k">def</span> <span class="nf">is_possible</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_diff</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return whether the given output `Difference` is possible.</span>

<span class="sd">        An output difference :math:`\\beta` is possible if exists</span>
<span class="sd">        :math:`x` such that :math:`f_{\\alpha} (x) = \\beta`.</span>

<span class="sd">        If the output difference is a constant value, this method returns</span>
<span class="sd">        the `Constant` ``0b1`` or ``0b0`` depending on whether the output</span>
<span class="sd">        difference in possible. If the output difference is symbolic,</span>
<span class="sd">        this method returns a bit-vector `Term` that evaluates to ``0b1``</span>
<span class="sd">        or ``0b0`` depending on whether the symbolic output difference is</span>
<span class="sd">        replaced by a valid output difference.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;subclasses need to override this method&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Derivative.has_probability_one"><a class="viewcode-back" href="../../../arxpy.differential.derivative.html#arxpy.differential.derivative.Derivative.has_probability_one">[docs]</a>    <span class="k">def</span> <span class="nf">has_probability_one</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_diff</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return whether the input difference propagates to the given output difference</span>
<span class="sd">        with probability one.&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="Derivative.weight"><a class="viewcode-back" href="../../../arxpy.differential.derivative.html#arxpy.differential.derivative.Derivative.weight">[docs]</a>    <span class="k">def</span> <span class="nf">weight</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_diff</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the weight of a possible output `Difference`.</span>

<span class="sd">        Let :math:`\\beta` be the given output difference. The *probability of the differential*</span>
<span class="sd">        :math:`p = Pr(\\alpha \\xrightarrow{f} \\beta)` is defined as the *proportion* of</span>
<span class="sd">        :math:`f_{\\alpha}`-preimages of :math:`\\beta`, that is,</span>
<span class="sd">        :math:`p \ = \ \# \{ x \ : \ f_{\\alpha} (x) = \\beta \} / 2^{n}`,</span>
<span class="sd">        where :math:`n` is the bit-width of :math:`x`.</span>

<span class="sd">        By default, the weight is defined as the closest integer of :math:`- \log_2(p)`,</span>
<span class="sd">        but some derivatives may consider other definitions of weight.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="Derivative.max_weight"><a class="viewcode-back" href="../../../arxpy.differential.derivative.html#arxpy.differential.derivative.Derivative.max_weight">[docs]</a>    <span class="k">def</span> <span class="nf">max_weight</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the maximum value the weight can achieve.&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="Derivative.exact_weight"><a class="viewcode-back" href="../../../arxpy.differential.derivative.html#arxpy.differential.derivative.Derivative.exact_weight">[docs]</a>    <span class="k">def</span> <span class="nf">exact_weight</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_diff</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the weight without rounding to the closest integer.</span>

<span class="sd">        It is assumed the exact weight is always smaller than the weight.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="Derivative.num_frac_bits"><a class="viewcode-back" href="../../../arxpy.differential.derivative.html#arxpy.differential.derivative.Derivative.num_frac_bits">[docs]</a>    <span class="k">def</span> <span class="nf">num_frac_bits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the number of fractional bits in the weight.&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="Derivative.error"><a class="viewcode-back" href="../../../arxpy.differential.derivative.html#arxpy.differential.derivative.Derivative.error">[docs]</a>    <span class="k">def</span> <span class="nf">error</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the maximum difference between the weight and the exact weight.</span>

<span class="sd">        This method returns an upper bound (in absolute value) of the maximum difference</span>
<span class="sd">        (over all input and output difference) between the weight and the exact weight.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_replace_input_diff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_input_diff</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a new derivative object with the input difference replaced.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">new_input_diff</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="XDA"><a class="viewcode-back" href="../../../arxpy.differential.derivative.html#arxpy.differential.derivative.XDA">[docs]</a><span class="k">class</span> <span class="nc">XDA</span><span class="p">(</span><span class="n">Derivative</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Represent the `XorDiff` `Derivative` of `BvAdd`.</span>

<span class="sd">        &gt;&gt;&gt; from arxpy.bitvector.core import Constant, Variable</span>
<span class="sd">        &gt;&gt;&gt; from arxpy.differential.difference import XorDiff</span>
<span class="sd">        &gt;&gt;&gt; from arxpy.differential.derivative import XDA</span>
<span class="sd">        &gt;&gt;&gt; alpha = XorDiff(Constant(0, 4)), XorDiff(Constant(0, 4))</span>
<span class="sd">        &gt;&gt;&gt; f = XDA(alpha)</span>
<span class="sd">        &gt;&gt;&gt; x = Constant(0, 4), Constant(0, 4)</span>
<span class="sd">        &gt;&gt;&gt; f.eval(*x)  # f(x + alpha) - f(x)</span>
<span class="sd">        XorDiff(0x0)</span>
<span class="sd">        &gt;&gt;&gt; f.max_weight(), f.error(), f.num_frac_bits()</span>
<span class="sd">        (3, 0, 0)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">diff_type</span> <span class="o">=</span> <span class="n">difference</span><span class="o">.</span><span class="n">XorDiff</span>
    <span class="n">op</span> <span class="o">=</span> <span class="n">operation</span><span class="o">.</span><span class="n">BvAdd</span>

<div class="viewcode-block" id="XDA.is_possible"><a class="viewcode-back" href="../../../arxpy.differential.derivative.html#arxpy.differential.derivative.XDA.is_possible">[docs]</a>    <span class="k">def</span> <span class="nf">is_possible</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_diff</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return whether the given output `XorDiff` is possible.</span>

<span class="sd">            &gt;&gt;&gt; from arxpy.bitvector.core import Constant, Variable</span>
<span class="sd">            &gt;&gt;&gt; from arxpy.differential.difference import XorDiff</span>
<span class="sd">            &gt;&gt;&gt; from arxpy.differential.derivative import XDA</span>
<span class="sd">            &gt;&gt;&gt; alpha = XorDiff(Constant(0, 4)), XorDiff(Constant(0, 4))</span>
<span class="sd">            &gt;&gt;&gt; f = XDA(alpha)</span>
<span class="sd">            &gt;&gt;&gt; beta = XorDiff(Constant(0, 4))</span>
<span class="sd">            &gt;&gt;&gt; f.is_possible(beta)</span>
<span class="sd">            0b1</span>
<span class="sd">            &gt;&gt;&gt; a0, a1, b = Variable(&quot;a0&quot;, 4), Variable(&quot;a1&quot;, 4), Variable(&quot;b&quot;, 4)</span>
<span class="sd">            &gt;&gt;&gt; alpha = XorDiff(a0), XorDiff(a1)</span>
<span class="sd">            &gt;&gt;&gt; f = XDA(alpha)</span>
<span class="sd">            &gt;&gt;&gt; beta = XorDiff(b)</span>
<span class="sd">            &gt;&gt;&gt; result = f.is_possible(beta)</span>
<span class="sd">            &gt;&gt;&gt; result</span>
<span class="sd">            0x0 == ((~(a0 &lt;&lt; 0x1) ^ (a1 &lt;&lt; 0x1)) &amp; (~(a0 &lt;&lt; 0x1) ^ (b &lt;&lt; 0x1)) &amp; ((a0 &lt;&lt; 0x1) ^ b ^ a0 ^ a1))</span>
<span class="sd">            &gt;&gt;&gt; result.xreplace({a0: Constant(0, 4), a1: Constant(0, 4), b: Constant(0, 4)})</span>
<span class="sd">            0b1</span>
<span class="sd">            &gt;&gt;&gt; a1 = Constant(0, 4)</span>
<span class="sd">            &gt;&gt;&gt; alpha = XorDiff(a0), XorDiff(a1)</span>
<span class="sd">            &gt;&gt;&gt; f = XDA(alpha)</span>
<span class="sd">            &gt;&gt;&gt; beta = XorDiff(b)</span>
<span class="sd">            &gt;&gt;&gt; result = f.is_possible(beta)</span>
<span class="sd">            &gt;&gt;&gt; result</span>
<span class="sd">            0x0 == (~(a0 &lt;&lt; 0x1) &amp; ~(b &lt;&lt; 0x1) &amp; (a0 ^ b))</span>

<span class="sd">        See `Derivative.is_possible` for more information.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="o">.</span><span class="n">val</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_diff</span><span class="p">]</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">output_diff</span><span class="o">.</span><span class="n">val</span>

        <span class="n">one</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">Constant</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">width</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">eq</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">core</span><span class="o">.</span><span class="n">Constant</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">core</span><span class="o">.</span><span class="n">Constant</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">eq</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">core</span><span class="o">.</span><span class="n">Constant</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">eq</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

            <span class="k">return</span> <span class="p">(</span><span class="o">~</span><span class="n">x</span> <span class="o">^</span> <span class="n">y</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">x</span> <span class="o">^</span> <span class="n">z</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">xor_shift</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">core</span><span class="o">.</span><span class="n">Constant</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">core</span><span class="o">.</span><span class="n">Constant</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">xor_shift</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">core</span><span class="o">.</span><span class="n">Constant</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">xor_shift</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

            <span class="k">return</span> <span class="p">(</span><span class="n">x</span> <span class="o">^</span> <span class="n">y</span> <span class="o">^</span> <span class="n">z</span> <span class="o">^</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;&lt;</span> <span class="n">one</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">operation</span><span class="o">.</span><span class="n">BvComp</span><span class="p">(</span>
            <span class="n">eq</span><span class="p">(</span><span class="n">a</span> <span class="o">&lt;&lt;</span> <span class="n">one</span><span class="p">,</span> <span class="n">b</span> <span class="o">&lt;&lt;</span> <span class="n">one</span><span class="p">,</span> <span class="n">c</span> <span class="o">&lt;&lt;</span> <span class="n">one</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">xor_shift</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">),</span>
            <span class="n">core</span><span class="o">.</span><span class="n">Constant</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">width</span><span class="p">))</span></div>

        <span class="c1"># # https://doi.org/10.1007/3-540-36231-2_5</span>
        <span class="c1"># dx1, dx2 = [d.val for d in self.input_diff]</span>
        <span class="c1"># dy = output_diff.val</span>
        <span class="c1"># one = core.Constant(1, dx1.width)</span>
        <span class="c1">#</span>
        <span class="c1"># impossible = ~( ((dx1^dy) &lt;&lt; one) | ((dx2^dy) &lt;&lt; one) ) &amp; (dx1^dx2^dy^(dx2&lt;&lt;one))</span>
        <span class="c1">#</span>
        <span class="c1"># return operation.BvComp(impossible, core.Constant(0, dx1.width))</span>

<div class="viewcode-block" id="XDA.has_probability_one"><a class="viewcode-back" href="../../../arxpy.differential.derivative.html#arxpy.differential.derivative.XDA.has_probability_one">[docs]</a>    <span class="k">def</span> <span class="nf">has_probability_one</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_diff</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return whether the input diff propagates to the output diff with probability one.</span>

<span class="sd">            &gt;&gt;&gt; from arxpy.bitvector.core import Constant, Variable</span>
<span class="sd">            &gt;&gt;&gt; from arxpy.differential.difference import XorDiff</span>
<span class="sd">            &gt;&gt;&gt; from arxpy.differential.derivative import XDA</span>
<span class="sd">            &gt;&gt;&gt; alpha = XorDiff(Constant(0, 4)), XorDiff(Constant(0, 4))</span>
<span class="sd">            &gt;&gt;&gt; f = XDA(alpha)</span>
<span class="sd">            &gt;&gt;&gt; f.has_probability_one(XorDiff(Constant(0, 4)))</span>
<span class="sd">            0b1</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">is_possible</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_possible</span><span class="p">(</span><span class="n">output_diff</span><span class="p">)</span>

        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="o">.</span><span class="n">val</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_diff</span><span class="p">]</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">output_diff</span><span class="o">.</span><span class="n">val</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">width</span>

        <span class="k">def</span> <span class="nf">eq</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">core</span><span class="o">.</span><span class="n">Constant</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">core</span><span class="o">.</span><span class="n">Constant</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">eq</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">core</span><span class="o">.</span><span class="n">Constant</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">eq</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

            <span class="k">return</span> <span class="p">(</span><span class="o">~</span><span class="n">x</span> <span class="o">^</span> <span class="n">y</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">x</span> <span class="o">^</span> <span class="n">z</span><span class="p">)</span>

        <span class="c1"># not optimized</span>

        <span class="k">return</span> <span class="n">is_possible</span> <span class="o">&amp;</span> <span class="n">operation</span><span class="o">.</span><span class="n">BvComp</span><span class="p">(</span>
            <span class="p">(</span><span class="o">~</span><span class="n">eq</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">))[</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">:],</span>
            <span class="n">core</span><span class="o">.</span><span class="n">Constant</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="XDA.weight"><a class="viewcode-back" href="../../../arxpy.differential.derivative.html#arxpy.differential.derivative.XDA.weight">[docs]</a>    <span class="k">def</span> <span class="nf">weight</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_diff</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the weight of a possible output `XorDiff`.</span>

<span class="sd">        For XDA, the probability of a valid differential is :math:`2^{-i}`</span>
<span class="sd">        for some :math:`i`, and the weight is defined as the exponent</span>
<span class="sd">        :math:`i`.</span>

<span class="sd">            &gt;&gt;&gt; from arxpy.bitvector.core import Constant, Variable</span>
<span class="sd">            &gt;&gt;&gt; from arxpy.differential.difference import XorDiff</span>
<span class="sd">            &gt;&gt;&gt; from arxpy.differential.derivative import XDA</span>
<span class="sd">            &gt;&gt;&gt; n = 4</span>
<span class="sd">            &gt;&gt;&gt; alpha = XorDiff(Constant(0, n)), XorDiff(Constant(0, n))</span>
<span class="sd">            &gt;&gt;&gt; f = XDA(alpha)</span>
<span class="sd">            &gt;&gt;&gt; f.weight(XorDiff(Constant(0, n)))</span>
<span class="sd">            0b00</span>
<span class="sd">            &gt;&gt;&gt; a0, a1, b = Variable(&quot;a0&quot;, n), Variable(&quot;a1&quot;, n), Variable(&quot;b&quot;, n)</span>
<span class="sd">            &gt;&gt;&gt; alpha = XorDiff(a0), XorDiff(a1)</span>
<span class="sd">            &gt;&gt;&gt; f = XDA(alpha)</span>
<span class="sd">            &gt;&gt;&gt; result = f.weight(XorDiff(b))</span>
<span class="sd">            &gt;&gt;&gt; result  # doctest:+NORMALIZE_WHITESPACE</span>
<span class="sd">            (0b0 :: (~((a1 ^ ~a0) &amp; (b ^ ~a0))[0])) + (0b0 :: (~((a1 ^ ~a0) &amp; (b ^ ~a0))[1])) +</span>
<span class="sd">            (0b0 :: (~((a1 ^ ~a0) &amp; (b ^ ~a0))[2]))</span>
<span class="sd">            &gt;&gt;&gt; result.xreplace({a0: Constant(0, n), a1: Constant(0, n), b: Constant(0, n)})</span>
<span class="sd">            0b00</span>

<span class="sd">        See `Derivative.weight` for more information.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="o">.</span><span class="n">val</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_diff</span><span class="p">]</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">output_diff</span><span class="o">.</span><span class="n">val</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">width</span>

        <span class="k">def</span> <span class="nf">eq</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">core</span><span class="o">.</span><span class="n">Constant</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">core</span><span class="o">.</span><span class="n">Constant</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">eq</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">core</span><span class="o">.</span><span class="n">Constant</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">eq</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

            <span class="k">return</span> <span class="p">(</span><span class="o">~</span><span class="n">x</span> <span class="o">^</span> <span class="n">y</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">x</span> <span class="o">^</span> <span class="n">z</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">extraop</span><span class="o">.</span><span class="n">PopCount</span><span class="p">((</span><span class="o">~</span><span class="n">eq</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">))[</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">:])</span>  <span class="c1"># ignore MSB</span></div>

        <span class="c1"># # https://doi.org/10.1007/3-540-36231-2_5</span>
        <span class="c1"># dx1, dx2 = [d.val for d in self.input_diff]</span>
        <span class="c1"># dy = output_diff.val</span>
        <span class="c1"># one = core.Constant(1, dx1.width)</span>
        <span class="c1">#</span>
        <span class="c1"># w = ((dx1^dy) &lt;&lt; one) | ((dx2^dy) &lt;&lt; one)</span>
        <span class="c1">#</span>
        <span class="c1"># return extraop.PopCount(w)</span>

<div class="viewcode-block" id="XDA.max_weight"><a class="viewcode-back" href="../../../arxpy.differential.derivative.html#arxpy.differential.derivative.XDA.max_weight">[docs]</a>    <span class="k">def</span> <span class="nf">max_weight</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_diff</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">val</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="mi">1</span>  <span class="c1"># MSB is ignored</span>
        <span class="k">return</span> <span class="n">width</span>  <span class="c1"># as an integer</span></div>

<div class="viewcode-block" id="XDA.exact_weight"><a class="viewcode-back" href="../../../arxpy.differential.derivative.html#arxpy.differential.derivative.XDA.exact_weight">[docs]</a>    <span class="k">def</span> <span class="nf">exact_weight</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_diff</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="p">(</span><span class="n">output_diff</span><span class="p">))</span></div>

<div class="viewcode-block" id="XDA.num_frac_bits"><a class="viewcode-back" href="../../../arxpy.differential.derivative.html#arxpy.differential.derivative.XDA.num_frac_bits">[docs]</a>    <span class="k">def</span> <span class="nf">num_frac_bits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">0</span></div>

<div class="viewcode-block" id="XDA.error"><a class="viewcode-back" href="../../../arxpy.differential.derivative.html#arxpy.differential.derivative.XDA.error">[docs]</a>    <span class="k">def</span> <span class="nf">error</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">0</span></div></div>


<div class="viewcode-block" id="XDS"><a class="viewcode-back" href="../../../arxpy.differential.derivative.html#arxpy.differential.derivative.XDS">[docs]</a><span class="k">class</span> <span class="nc">XDS</span><span class="p">(</span><span class="n">XDA</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Represent the `XorDiff` `Derivative` of `BvSub`.</span>

<span class="sd">        &gt;&gt;&gt; from arxpy.bitvector.core import Constant, Variable</span>
<span class="sd">        &gt;&gt;&gt; from arxpy.differential.difference import XorDiff</span>
<span class="sd">        &gt;&gt;&gt; from arxpy.differential.derivative import XDS</span>
<span class="sd">        &gt;&gt;&gt; alpha = XorDiff(Constant(0, 4)), XorDiff(Constant(0, 4))</span>
<span class="sd">        &gt;&gt;&gt; f = XDS(alpha)</span>
<span class="sd">        &gt;&gt;&gt; x = Constant(0, 4), Constant(0, 4)</span>
<span class="sd">        &gt;&gt;&gt; f.eval(*x)  # f(x + alpha) - f(x)</span>
<span class="sd">        XorDiff(0x0)</span>
<span class="sd">        &gt;&gt;&gt; f.max_weight(), f.error(), f.num_frac_bits()</span>
<span class="sd">        (3, 0, 0)</span>

<span class="sd">    The differential model of the modular substraction</span>
<span class="sd">    is the same as the model for the modular addition</span>
<span class="sd">    (see `XDA`).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">diff_type</span> <span class="o">=</span> <span class="n">difference</span><span class="o">.</span><span class="n">XorDiff</span>
    <span class="n">op</span> <span class="o">=</span> <span class="n">operation</span><span class="o">.</span><span class="n">BvSub</span></div>


<div class="viewcode-block" id="RXDA"><a class="viewcode-back" href="../../../arxpy.differential.derivative.html#arxpy.differential.derivative.RXDA">[docs]</a><span class="k">class</span> <span class="nc">RXDA</span><span class="p">(</span><span class="n">Derivative</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Represent the `RXDiff` `Derivative` of `BvAdd`.</span>

<span class="sd">            &gt;&gt;&gt; from arxpy.bitvector.core import Constant, Variable</span>
<span class="sd">            &gt;&gt;&gt; from arxpy.differential.difference import RXDiff</span>
<span class="sd">            &gt;&gt;&gt; from arxpy.differential.derivative import RXDA</span>
<span class="sd">            &gt;&gt;&gt; alpha = RXDiff(Constant(0, 16)), RXDiff(Constant(0, 16))</span>
<span class="sd">            &gt;&gt;&gt; f = RXDA(alpha)</span>
<span class="sd">            &gt;&gt;&gt; x = Constant(0, 16), Constant(0, 16)</span>
<span class="sd">            &gt;&gt;&gt; f.eval(*x)  # f(x + alpha) - f(x)</span>
<span class="sd">            RXDiff(0x0000)</span>
<span class="sd">            &gt;&gt;&gt; f.max_weight(), f.error(), f.num_frac_bits()</span>
<span class="sd">            (136, 0.03999347239201656, 3)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">diff_type</span> <span class="o">=</span> <span class="n">difference</span><span class="o">.</span><span class="n">RXDiff</span>
    <span class="n">op</span> <span class="o">=</span> <span class="n">operation</span><span class="o">.</span><span class="n">BvAdd</span>
    <span class="n">precision</span> <span class="o">=</span> <span class="mi">3</span>  <span class="c1"># 0, 2, 3, 6, 7, 8, 10</span>

<div class="viewcode-block" id="RXDA.is_possible"><a class="viewcode-back" href="../../../arxpy.differential.derivative.html#arxpy.differential.derivative.RXDA.is_possible">[docs]</a>    <span class="k">def</span> <span class="nf">is_possible</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_diff</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return whether the given output `RXDiff` is possible.</span>

<span class="sd">            &gt;&gt;&gt; from arxpy.bitvector.core import Constant, Variable</span>
<span class="sd">            &gt;&gt;&gt; from arxpy.differential.difference import RXDiff</span>
<span class="sd">            &gt;&gt;&gt; from arxpy.differential.derivative import RXDA</span>
<span class="sd">            &gt;&gt;&gt; alpha = RXDiff(Constant(0, 4)), RXDiff(Constant(0, 4))</span>
<span class="sd">            &gt;&gt;&gt; f = RXDA(alpha)</span>
<span class="sd">            &gt;&gt;&gt; beta = RXDiff(Constant(0, 4))</span>
<span class="sd">            &gt;&gt;&gt; f.is_possible(beta)</span>
<span class="sd">            0b1</span>
<span class="sd">            &gt;&gt;&gt; a0, a1, b = Variable(&quot;a0&quot;, 4), Variable(&quot;a1&quot;, 4), Variable(&quot;b&quot;, 4)</span>
<span class="sd">            &gt;&gt;&gt; alpha = RXDiff(a0), RXDiff(a1)</span>
<span class="sd">            &gt;&gt;&gt; f = RXDA(alpha)</span>
<span class="sd">            &gt;&gt;&gt; beta = RXDiff(b)</span>
<span class="sd">            &gt;&gt;&gt; result = f.is_possible(beta)</span>
<span class="sd">            &gt;&gt;&gt; result  # doctest:+NORMALIZE_WHITESPACE</span>
<span class="sd">            0b11 == (~(((((a0[:1]) ^ (a1[:1]) ^ (b[:1])) &lt;&lt; 0b001) ^ (a0[:1]) ^ (a1[:1]) ^ (b[:1]))[:1]) |</span>
<span class="sd">            ((((a0[:1]) ^ (b[:1])) | ((a1[:1]) ^ (b[:1])))[1:]))</span>
<span class="sd">            &gt;&gt;&gt; result.xreplace({a0: Constant(0, 4), a1: Constant(0, 4), b: Constant(0, 4)})</span>
<span class="sd">            0b1</span>
<span class="sd">            &gt;&gt;&gt; a1 = Constant(0, 4)</span>
<span class="sd">            &gt;&gt;&gt; alpha = RXDiff(a0), RXDiff(a1)</span>
<span class="sd">            &gt;&gt;&gt; f = RXDA(alpha)</span>
<span class="sd">            &gt;&gt;&gt; beta = RXDiff(b)</span>
<span class="sd">            &gt;&gt;&gt; result = f.is_possible(beta)</span>
<span class="sd">            &gt;&gt;&gt; result  # doctest:+NORMALIZE_WHITESPACE</span>
<span class="sd">            0b11 == (~(((((a0[:1]) ^ (b[:1])) &lt;&lt; 0b001) ^ (a0[:1]) ^ (b[:1]))[:1])</span>
<span class="sd">            | ((((a0[:1]) ^ (b[:1])) | (b[:1]))[1:]))</span>

<span class="sd">        See `Derivative.is_possible` for more information.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># (I ^ SHL)(da ^ db ^ dc)[1:] &lt;= SHL((da ^ dc) OR (db ^ dc))[1:]</span>

        <span class="c1"># one = core.Constant(1, self.input_diff[0].val.width)  # alt v1</span>

        <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="o">.</span><span class="n">val</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_diff</span><span class="p">]</span>
        <span class="n">gamma</span> <span class="o">=</span> <span class="n">output_diff</span><span class="o">.</span><span class="n">val</span>
        <span class="c1"># da, db, dc = alpha &gt;&gt; one, beta &gt;&gt; one, gamma &gt;&gt; one  # alt v1</span>
        <span class="n">da</span><span class="p">,</span> <span class="n">db</span><span class="p">,</span> <span class="n">dc</span> <span class="o">=</span> <span class="n">alpha</span><span class="p">[:</span><span class="mi">1</span><span class="p">],</span> <span class="n">beta</span><span class="p">[:</span><span class="mi">1</span><span class="p">],</span> <span class="n">gamma</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># ignore LSB</span>

        <span class="n">one</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">Constant</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">da</span><span class="o">.</span><span class="n">width</span><span class="p">)</span>

        <span class="c1"># lhs = (da ^ db ^ dc) ^ ((da ^ db ^ dc) &lt;&lt; one)  # alt v1</span>
        <span class="c1"># rhs = ((da ^ dc) | (db ^ dc)) &lt;&lt; one</span>
        <span class="n">lhs</span> <span class="o">=</span> <span class="p">((</span><span class="n">da</span> <span class="o">^</span> <span class="n">db</span> <span class="o">^</span> <span class="n">dc</span><span class="p">)</span> <span class="o">^</span> <span class="p">((</span><span class="n">da</span> <span class="o">^</span> <span class="n">db</span> <span class="o">^</span> <span class="n">dc</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">one</span><span class="p">))[:</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">rhs</span> <span class="o">=</span> <span class="p">(((</span><span class="n">da</span> <span class="o">^</span> <span class="n">dc</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">db</span> <span class="o">^</span> <span class="n">dc</span><span class="p">))</span> <span class="o">&lt;&lt;</span> <span class="n">one</span><span class="p">)[:</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">def</span> <span class="nf">bitwise_implication</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span><span class="o">~</span><span class="n">x</span><span class="p">)</span> <span class="o">|</span> <span class="n">y</span>

        <span class="c1"># alt v1</span>
        <span class="c1"># n = lhs.width</span>
        <span class="c1"># return operation.BvComp(</span>
        <span class="c1">#     bitwise_implication(lhs[n - 2:1], rhs[n - 2:1]),  # ignore MSB, LSB</span>
        <span class="c1">#     ~ core.Constant(0, n - 2))</span>
        <span class="k">return</span> <span class="n">operation</span><span class="o">.</span><span class="n">BvComp</span><span class="p">(</span><span class="n">bitwise_implication</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">),</span> <span class="o">~</span><span class="n">core</span><span class="o">.</span><span class="n">Constant</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">lhs</span><span class="o">.</span><span class="n">width</span><span class="p">))</span>  <span class="c1"># alt v1</span></div>

<div class="viewcode-block" id="RXDA.has_probability_one"><a class="viewcode-back" href="../../../arxpy.differential.derivative.html#arxpy.differential.derivative.RXDA.has_probability_one">[docs]</a>    <span class="k">def</span> <span class="nf">has_probability_one</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_diff</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return whether the input diff propagates to the output diff with probability one.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">core</span><span class="o">.</span><span class="n">Constant</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="RXDA.decimal2bin"><a class="viewcode-back" href="../../../arxpy.differential.derivative.html#arxpy.differential.derivative.RXDA.decimal2bin">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">decimal2bin</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">precision</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a binary representation of a positive real number.&quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">number</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="n">binary_str</span> <span class="o">=</span> <span class="nb">bin</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">number</span><span class="p">))</span>
        <span class="n">frac</span> <span class="o">=</span> <span class="n">number</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">precision</span><span class="p">):</span>
            <span class="n">frac</span> <span class="o">*=</span> <span class="mi">2</span>
            <span class="n">frac_bit</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">frac</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">frac_bit</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">frac</span> <span class="o">-=</span> <span class="n">frac_bit</span>
                <span class="n">binary_str</span> <span class="o">+=</span> <span class="s1">&#39;1&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">binary_str</span> <span class="o">+=</span> <span class="s1">&#39;0&#39;</span>
        <span class="k">return</span> <span class="n">binary_str</span></div>

<div class="viewcode-block" id="RXDA.weight"><a class="viewcode-back" href="../../../arxpy.differential.derivative.html#arxpy.differential.derivative.RXDA.weight">[docs]</a>    <span class="k">def</span> <span class="nf">weight</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_diff</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the weight of a possible output `RXDiff`.</span>

<span class="sd">            &gt;&gt;&gt; from arxpy.bitvector.core import Constant, Variable</span>
<span class="sd">            &gt;&gt;&gt; from arxpy.differential.difference import RXDiff</span>
<span class="sd">            &gt;&gt;&gt; from arxpy.differential.derivative import RXDA</span>
<span class="sd">            &gt;&gt;&gt; n = 4</span>
<span class="sd">            &gt;&gt;&gt; alpha = RXDiff(Constant(0, n)), RXDiff(Constant(0, n))</span>
<span class="sd">            &gt;&gt;&gt; f = RXDA(alpha)</span>
<span class="sd">            &gt;&gt;&gt; f.weight(RXDiff(Constant(0, n)))</span>
<span class="sd">            0b001001</span>
<span class="sd">            &gt;&gt;&gt; a0, a1, b = Variable(&quot;a0&quot;, n), Variable(&quot;a1&quot;, n), Variable(&quot;b&quot;, n)</span>
<span class="sd">            &gt;&gt;&gt; alpha = RXDiff(a0), RXDiff(a1)</span>
<span class="sd">            &gt;&gt;&gt; f = RXDA(alpha)</span>
<span class="sd">            &gt;&gt;&gt; result = f.weight(RXDiff(b))</span>
<span class="sd">            &gt;&gt;&gt; result  # doctest:+NORMALIZE_WHITESPACE</span>
<span class="sd">            ((0x0 :: ((0b0 :: ((((a0[:1]) ^ (b[:1])) | ((a1[:1]) ^ (b[:1])))[0])) + (0b0 :: ((((a0[:1]) ^ (b[:1])) |</span>
<span class="sd">            ((a1[:1]) ^ (b[:1])))[1])))) &lt;&lt; 0b000011) + (Ite(~((a0[1]) ^ (a1[1]) ^ (b[1])), 0b001001, 0b011000))</span>
<span class="sd">            &gt;&gt;&gt; result.xreplace({a0: Constant(0, n), a1: Constant(0, n), b: Constant(0, n)})</span>
<span class="sd">            0b001001</span>

<span class="sd">        See `Derivative.weight` for more information.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># one = core.Constant(1, self.input_diff[0].val.width)  # alt v1</span>
        <span class="c1"># two = core.Constant(2, self.input_diff[0].val.width)</span>

        <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="o">.</span><span class="n">val</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_diff</span><span class="p">]</span>
        <span class="n">gamma</span> <span class="o">=</span> <span class="n">output_diff</span><span class="o">.</span><span class="n">val</span>
        <span class="n">da</span><span class="p">,</span> <span class="n">db</span><span class="p">,</span> <span class="n">dc</span> <span class="o">=</span> <span class="n">alpha</span><span class="p">[:</span><span class="mi">1</span><span class="p">],</span> <span class="n">beta</span><span class="p">[:</span><span class="mi">1</span><span class="p">],</span> <span class="n">gamma</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># alt v1</span>
        <span class="c1"># da, db, dc = alpha &gt;&gt; one, beta &gt;&gt; one, gamma &gt;&gt; one  # alt v1</span>

        <span class="n">rhs</span> <span class="o">=</span> <span class="p">((</span><span class="n">da</span> <span class="o">^</span> <span class="n">dc</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">db</span> <span class="o">^</span> <span class="n">dc</span><span class="p">))[</span><span class="n">da</span><span class="o">.</span><span class="n">width</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span>  <span class="c1"># equiv to shift left</span>
        <span class="c1"># rhs = ((da ^ dc) | (db ^ dc)) &lt;&lt; two  # alt v1</span>
        <span class="n">hw</span> <span class="o">=</span> <span class="n">extraop</span><span class="o">.</span><span class="n">PopCount</span><span class="p">(</span><span class="n">rhs</span><span class="p">)</span>

        <span class="n">max_hw</span> <span class="o">=</span> <span class="n">rhs</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="c1"># (max_hw + 3) = maximum integer part</span>
        <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">precision</span>  <span class="c1"># num fraction bits</span>
        <span class="n">weight_width</span> <span class="o">=</span> <span class="p">(</span><span class="n">max_hw</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">bit_length</span><span class="p">()</span> <span class="o">+</span> <span class="n">k</span>

        <span class="c1"># let lhs = LSB(lhs) = da ^ db ^ dc</span>
        <span class="c1">#     rhs = LSB(rhs) = 0</span>
        <span class="c1"># case A (w=1.415): lhs =&gt; rhs</span>
        <span class="c1"># case B (w=3):     lhs ^ 1 =&gt; rhs</span>
        <span class="c1"># 1.415 = -log2(pr propagation of a rotational pair with offset 1)</span>
        <span class="c1"># bin(1.415) = 1.01101010001111010111</span>

        <span class="n">n</span> <span class="o">=</span> <span class="n">alpha</span><span class="o">.</span><span class="n">width</span>
        <span class="n">w_rotational_pair</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">log2</span><span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="n">n</span><span class="p">)))</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">w_rotational_pair</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">decimal2bin</span><span class="p">(</span><span class="n">w_rotational_pair</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">base</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">bitwise_implication</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span><span class="o">~</span><span class="n">x</span><span class="p">)</span> <span class="o">|</span> <span class="n">y</span>

        <span class="n">cte_part</span> <span class="o">=</span> <span class="n">operation</span><span class="o">.</span><span class="n">Ite</span><span class="p">(</span>
            <span class="n">bitwise_implication</span><span class="p">(</span><span class="n">da</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">^</span> <span class="n">db</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">^</span> <span class="n">dc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">core</span><span class="o">.</span><span class="n">Constant</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
            <span class="n">core</span><span class="o">.</span><span class="n">Constant</span><span class="p">(</span><span class="n">w_rotational_pair</span><span class="p">,</span> <span class="n">weight_width</span><span class="p">),</span>
            <span class="n">core</span><span class="o">.</span><span class="n">Constant</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">weight_width</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">k</span>
        <span class="p">)</span>

        <span class="n">hw_extend</span> <span class="o">=</span> <span class="n">operation</span><span class="o">.</span><span class="n">ZeroExtend</span><span class="p">(</span><span class="n">hw</span><span class="p">,</span> <span class="n">weight_width</span> <span class="o">-</span> <span class="n">hw</span><span class="o">.</span><span class="n">width</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">hw_extend</span> <span class="o">&lt;&lt;</span> <span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">cte_part</span></div>

<div class="viewcode-block" id="RXDA.max_weight"><a class="viewcode-back" href="../../../arxpy.differential.derivative.html#arxpy.differential.derivative.RXDA.max_weight">[docs]</a>    <span class="k">def</span> <span class="nf">max_weight</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_diff</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">val</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="mi">2</span>  <span class="c1"># LSB, MSB ignored</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">width</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">precision</span>  <span class="c1"># as an integer</span></div>

<div class="viewcode-block" id="RXDA.exact_weight"><a class="viewcode-back" href="../../../arxpy.differential.derivative.html#arxpy.differential.derivative.RXDA.exact_weight">[docs]</a>    <span class="k">def</span> <span class="nf">exact_weight</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_diff</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the weight without rounding to the closest integer.</span>

<span class="sd">        When the input/output differences have width smaller than 16,</span>
<span class="sd">        the exact weight does not coincide with the actual real weight.</span>
<span class="sd">        For example, for width=8, the error can be as high as 1.2.</span>
<span class="sd">        Moreover, in this case the exact weight is not always smaller</span>
<span class="sd">        than the weight.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="o">.</span><span class="n">val</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_diff</span><span class="p">]</span>
        <span class="n">gamma</span> <span class="o">=</span> <span class="n">output_diff</span><span class="o">.</span><span class="n">val</span>
        <span class="n">da</span><span class="p">,</span> <span class="n">db</span><span class="p">,</span> <span class="n">dc</span> <span class="o">=</span> <span class="n">alpha</span><span class="p">[:</span><span class="mi">1</span><span class="p">],</span> <span class="n">beta</span><span class="p">[:</span><span class="mi">1</span><span class="p">],</span> <span class="n">gamma</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">one</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">Constant</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">da</span><span class="o">.</span><span class="n">width</span><span class="p">)</span>

        <span class="n">rhs</span> <span class="o">=</span> <span class="p">((</span><span class="n">da</span> <span class="o">^</span> <span class="n">dc</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">db</span> <span class="o">^</span> <span class="n">dc</span><span class="p">))</span> <span class="o">&lt;&lt;</span> <span class="n">one</span>
        <span class="c1"># rhs = ((da ^ dc) | (db ^ dc))[da.width-2:]  # alt v1</span>
        <span class="n">hw</span> <span class="o">=</span> <span class="n">extraop</span><span class="o">.</span><span class="n">PopCount</span><span class="p">(</span><span class="n">rhs</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hw</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">bitwise_implication</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span><span class="o">~</span><span class="n">x</span><span class="p">)</span> <span class="o">|</span> <span class="n">y</span>

        <span class="n">n</span> <span class="o">=</span> <span class="n">alpha</span><span class="o">.</span><span class="n">width</span>
        <span class="n">w_rotational_pair</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">log2</span><span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">n</span><span class="p">)))</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">bitwise_implication</span><span class="p">(</span><span class="n">da</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">^</span> <span class="n">db</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">^</span> <span class="n">dc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">core</span><span class="o">.</span><span class="n">Constant</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">==</span> <span class="n">core</span><span class="o">.</span><span class="n">Constant</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">result</span> <span class="o">+=</span> <span class="n">w_rotational_pair</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">+=</span> <span class="mi">3</span>

        <span class="c1"># if debug:</span>
        <span class="c1">#     print(&quot;\n\n ~~ &quot;)</span>
        <span class="c1">#     print(&quot;da:           &quot;, da.bin())</span>
        <span class="c1">#     print(&quot;db:           &quot;, db.bin())</span>
        <span class="c1">#     print(&quot;dc:           &quot;, dc.bin())</span>
        <span class="c1">#     print(&quot;rhs:          &quot;, rhs.bin())</span>
        <span class="c1">#     print(&quot;hw:           &quot;, int(hw))</span>
        <span class="c1">#     print(&quot;bw_implies:   &quot;, bitwise_implication(da[0] ^ db[0] ^ dc[0], core.Constant(0, 1)).bin())</span>
        <span class="c1">#     print(&quot;result:       &quot;, result)</span>
        <span class="c1">#     print(&quot;\n\n&quot;)</span>

        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="RXDA.num_frac_bits"><a class="viewcode-back" href="../../../arxpy.differential.derivative.html#arxpy.differential.derivative.RXDA.num_frac_bits">[docs]</a>    <span class="k">def</span> <span class="nf">num_frac_bits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">precision</span></div>

<div class="viewcode-block" id="RXDA.error"><a class="viewcode-back" href="../../../arxpy.differential.derivative.html#arxpy.differential.derivative.RXDA.error">[docs]</a>    <span class="k">def</span> <span class="nf">error</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;&quot;Return the maximum difference between the weight and the exact weight.</span>

<span class="sd">            &gt;&gt;&gt; # docstring for debugging purposes</span>
<span class="sd">            &gt;&gt;&gt; from arxpy.bitvector.core import Constant, Variable</span>
<span class="sd">            &gt;&gt;&gt; from arxpy.differential.difference import RXDiff</span>
<span class="sd">            &gt;&gt;&gt; from arxpy.differential.derivative import RXDA</span>
<span class="sd">            &gt;&gt;&gt; old_prec = RXDA.precision</span>
<span class="sd">            &gt;&gt;&gt; errors = []</span>
<span class="sd">            &gt;&gt;&gt; n = 16</span>
<span class="sd">            &gt;&gt;&gt; for p in range(0, 12):</span>
<span class="sd">            ...     RXDA.precision = p</span>
<span class="sd">            ...     alpha = RXDiff(Constant(0, n)), RXDiff(Constant(0, n))</span>
<span class="sd">            ...     f = RXDA(alpha)</span>
<span class="sd">            ...     errors.append(round(f.error(), 4))</span>
<span class="sd">            &gt;&gt;&gt; RXDA.precision = old_prec</span>
<span class="sd">            &gt;&gt;&gt; errors</span>
<span class="sd">            [0.415, 0.415, 0.165, 0.04, 0.04, 0.0087, 0.0087, 0.0009, 0.0009, 0.0009, 0.0009, 0.0004]</span>

<span class="sd">        As opposed to `XDCA`, the exact weight in `RXDA` is bigger.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_diff</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">val</span><span class="o">.</span><span class="n">width</span>
        <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">precision</span>

        <span class="n">w_rotational_pair</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">log2</span><span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="n">n</span><span class="p">)))</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>

        <span class="n">w_rotational_pair_approx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">Constant</span><span class="p">(</span>
            <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">decimal2bin</span><span class="p">(</span><span class="n">w_rotational_pair</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">base</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
            <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="p">))</span> <span class="o">*</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="mi">2</span><span class="o">**</span><span class="n">k</span>

        <span class="c1"># w_rotational_pair_approx &lt; w_rotational_pair</span>
        <span class="n">theo_error</span> <span class="o">=</span> <span class="n">w_rotational_pair</span> <span class="o">-</span> <span class="n">w_rotational_pair_approx</span>

        <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">16</span><span class="p">:</span>
            <span class="n">theo_error</span> <span class="o">+=</span> <span class="mf">1.02</span>  <span class="c1"># offset found empirically for n=8</span>

        <span class="k">return</span> <span class="n">theo_error</span></div></div>


<div class="viewcode-block" id="XDCA"><a class="viewcode-back" href="../../../arxpy.differential.derivative.html#arxpy.differential.derivative.XDCA">[docs]</a><span class="k">class</span> <span class="nc">XDCA</span><span class="p">(</span><span class="n">Derivative</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Represent the derivative of addition by a constant w.r.t XOR differences.</span>

<span class="sd">        &gt;&gt;&gt; from arxpy.bitvector.core import Constant, Variable</span>
<span class="sd">        &gt;&gt;&gt; from arxpy.differential.difference import XorDiff</span>
<span class="sd">        &gt;&gt;&gt; from arxpy.differential.derivative import XDCA</span>
<span class="sd">        &gt;&gt;&gt; alpha, cte = XorDiff(Constant(0, 4)), Constant(1, 4)</span>
<span class="sd">        &gt;&gt;&gt; f = XDCA(alpha, cte)</span>
<span class="sd">        &gt;&gt;&gt; x = Constant(0, 4)</span>
<span class="sd">        &gt;&gt;&gt; f.eval(x)  # f(x + alpha) - f(x)</span>
<span class="sd">        XorDiff(0x0)</span>
<span class="sd">        &gt;&gt;&gt; f.max_weight(), f.error(), f.num_frac_bits()</span>
<span class="sd">        (6, 0.0860713320559343, 1)</span>

<span class="sd">    The class attribute ``precision`` controls how many fraction bits</span>
<span class="sd">    are used to approximate the weight. Its default value is ``3``,</span>
<span class="sd">    and lower values lead to simpler formulas with higher errors.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">diff_type</span> <span class="o">=</span> <span class="n">difference</span><span class="o">.</span><span class="n">XorDiff</span>
    <span class="c1"># op is a instance attribute</span>
    <span class="n">precision</span> <span class="o">=</span> <span class="mi">3</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_diff</span><span class="p">,</span> <span class="n">cte</span><span class="p">):</span>  <span class="c1"># noqa: 102</span>
        <span class="k">assert</span> <span class="n">cte</span> <span class="o">!=</span> <span class="mi">0</span>
        <span class="n">input_diff</span> <span class="o">=</span> <span class="n">_tuplify</span><span class="p">(</span><span class="n">input_diff</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">input_diff</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">val</span><span class="o">.</span><span class="n">width</span>
        <span class="n">cte</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">bitvectify</span><span class="p">(</span><span class="n">cte</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">op</span> <span class="o">=</span> <span class="n">extraop</span><span class="o">.</span><span class="n">make_partial_operation</span><span class="p">(</span><span class="n">operation</span><span class="o">.</span><span class="n">BvAdd</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">([</span><span class="kc">None</span><span class="p">,</span> <span class="n">cte</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">op</span><span class="o">.</span><span class="n">constant</span> <span class="o">=</span> <span class="n">cte</span>  <span class="c1"># temporary patch</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">input_diff</span><span class="p">)</span>

        <span class="n">index_first_one</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">cte</span><span class="o">.</span><span class="n">width</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">cte</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">index_first_one</span> <span class="o">=</span> <span class="n">i</span>
                <span class="k">break</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_index_first_one</span> <span class="o">=</span> <span class="n">index_first_one</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_effective_width</span> <span class="o">=</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">index_first_one</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_effective_precision</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">precision</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_effective_width</span> <span class="o">-</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># 2 found empirically</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">_</span><span class="si">{}</span><span class="s2">(</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">op</span><span class="o">.</span><span class="n">constant</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_diff</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="fm">__repr__</span> <span class="o">=</span> <span class="fm">__str__</span>

    <span class="c1"># noinspection PyPep8Naming</span>
    <span class="k">def</span> <span class="nf">_is_possible</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_diff</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_diff</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">val</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">output_diff</span><span class="o">.</span><span class="n">val</span>
        <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op</span><span class="o">.</span><span class="n">constant</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">width</span>

        <span class="n">one</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">Constant</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>

        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_effective_width</span> <span class="o">==</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="k">def</span> <span class="nf">carry</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
            <span class="c1"># carry[i] = Maj(x[i-1], y[i-1], carry[i-1])</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">)</span> <span class="o">^</span> <span class="n">x</span> <span class="o">^</span> <span class="n">y</span>

        <span class="c1"># # S_0 well defined</span>
        <span class="n">case11_</span> <span class="o">=</span> <span class="p">(</span><span class="n">u</span> <span class="o">&lt;&lt;</span> <span class="n">one</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">v</span> <span class="o">&lt;&lt;</span> <span class="n">one</span><span class="p">)</span>  <span class="c1"># i-bit is True if S_i = 11*</span>
        <span class="n">case00_</span> <span class="o">=</span> <span class="p">(</span><span class="o">~</span><span class="p">(</span><span class="n">u</span> <span class="o">&lt;&lt;</span> <span class="n">one</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="p">(</span><span class="n">v</span> <span class="o">&lt;&lt;</span> <span class="n">one</span><span class="p">))</span>  <span class="c1"># i-bit is True if S_i = 00*</span>
        <span class="n">case__1</span> <span class="o">=</span> <span class="n">u</span> <span class="o">^</span> <span class="n">v</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">a</span> <span class="o">&lt;&lt;</span> <span class="n">one</span>  <span class="c1"># i-bit holds a[i-1]</span>

        <span class="n">local_eq_a</span> <span class="o">=</span> <span class="o">~</span><span class="p">(</span><span class="n">a</span> <span class="o">^</span> <span class="p">(</span><span class="n">a</span> <span class="o">&lt;&lt;</span> <span class="n">one</span><span class="p">))</span>  <span class="c1"># i-bit is True if a[i-1] == a[i-2]</span>
        <span class="n">case00_prev</span> <span class="o">=</span> <span class="n">case00_</span> <span class="o">&lt;&lt;</span> <span class="n">one</span>  <span class="c1"># i-bit is True if S_{i-1} = 00*</span>

        <span class="n">c</span> <span class="o">=</span> <span class="n">carry</span><span class="p">(</span><span class="n">local_eq_a</span> <span class="o">&amp;</span> <span class="n">case00_</span><span class="p">,</span> <span class="p">(</span><span class="o">~</span><span class="n">case00_prev</span><span class="p">))</span>

        <span class="n">case001</span> <span class="o">=</span> <span class="n">case00_</span> <span class="o">&amp;</span> <span class="n">case__1</span>
        <span class="n">bad_case11_</span> <span class="o">=</span> <span class="n">case11_</span> <span class="o">&amp;</span> <span class="o">~</span><span class="p">(</span><span class="n">case__1</span> <span class="o">^</span> <span class="n">local_eq_a</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">c</span> <span class="o">|</span> <span class="o">~</span><span class="n">case00_prev</span><span class="p">)</span>

        <span class="n">bad_events</span> <span class="o">=</span> <span class="p">(</span><span class="n">case001</span> <span class="o">|</span> <span class="n">bad_case11_</span><span class="p">)</span>
        <span class="n">is_valid</span> <span class="o">=</span> <span class="n">operation</span><span class="o">.</span><span class="n">BvComp</span><span class="p">(</span><span class="n">bad_events</span><span class="p">,</span> <span class="n">core</span><span class="o">.</span><span class="n">Constant</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">bad_events</span><span class="o">.</span><span class="n">width</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2"> ~~ &quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;u:           &quot;</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">bin</span><span class="p">())</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;v:           &quot;</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">bin</span><span class="p">())</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;a:           &quot;</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">bin</span><span class="p">())</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;case11_:     &quot;</span><span class="p">,</span> <span class="n">case11_</span><span class="o">.</span><span class="n">bin</span><span class="p">())</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;case00_:     &quot;</span><span class="p">,</span> <span class="n">case00_</span><span class="o">.</span><span class="n">bin</span><span class="p">())</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;case__1:     &quot;</span><span class="p">,</span> <span class="n">case__1</span><span class="o">.</span><span class="n">bin</span><span class="p">())</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;case001:     &quot;</span><span class="p">,</span> <span class="n">case001</span><span class="o">.</span><span class="n">bin</span><span class="p">())</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;case00_prev: &quot;</span><span class="p">,</span> <span class="n">case00_prev</span><span class="o">.</span><span class="n">bin</span><span class="p">())</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;local_eq_a:  &quot;</span><span class="p">,</span> <span class="n">local_eq_a</span><span class="o">.</span><span class="n">bin</span><span class="p">())</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;c:           &quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">bin</span><span class="p">())</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;bad_case11_: &quot;</span><span class="p">,</span> <span class="n">bad_case11_</span><span class="o">.</span><span class="n">bin</span><span class="p">())</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;bad_events:  &quot;</span><span class="p">,</span> <span class="n">bad_events</span><span class="o">.</span><span class="n">bin</span><span class="p">())</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;is_valid    :&quot;</span><span class="p">,</span> <span class="n">is_valid</span><span class="o">.</span><span class="n">bin</span><span class="p">())</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">is_valid</span>

<div class="viewcode-block" id="XDCA.is_possible"><a class="viewcode-back" href="../../../arxpy.differential.derivative.html#arxpy.differential.derivative.XDCA.is_possible">[docs]</a>    <span class="k">def</span> <span class="nf">is_possible</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_diff</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return whether the given output `XorDiff` is possible.</span>

<span class="sd">            &gt;&gt;&gt; from arxpy.bitvector.core import Constant, Variable</span>
<span class="sd">            &gt;&gt;&gt; from arxpy.differential.difference import XorDiff</span>
<span class="sd">            &gt;&gt;&gt; from arxpy.differential.derivative import XDCA</span>
<span class="sd">            &gt;&gt;&gt; alpha, cte = XorDiff(Constant(0, 4)), Constant(1, 4)</span>
<span class="sd">            &gt;&gt;&gt; f = XDCA(alpha, cte)</span>
<span class="sd">            &gt;&gt;&gt; f.is_possible(XorDiff(Constant(0, 4)))</span>
<span class="sd">            0b1</span>
<span class="sd">            &gt;&gt;&gt; u, v = Variable(&quot;u&quot;, 4), Variable(&quot;v&quot;, 4)</span>
<span class="sd">            &gt;&gt;&gt; f = XDCA(XorDiff(u), cte)</span>
<span class="sd">            &gt;&gt;&gt; result = f.is_possible(XorDiff(v))</span>
<span class="sd">            &gt;&gt;&gt; result  # doctest: +NORMALIZE_WHITESPACE</span>
<span class="sd">            0x0 == (((u &lt;&lt; 0x1) &amp; (v &lt;&lt; 0x1) &amp; ~(0x9 ^ u ^ v) &amp; (~((~(u &lt;&lt; 0x1) &amp; ~(v &lt;&lt; 0x1)) &lt;&lt; 0x1) |</span>
<span class="sd">                   (~((~(u &lt;&lt; 0x1) &amp; ~(v &lt;&lt; 0x1)) &lt;&lt; 0x1) ^ ((0x9 &amp; ~(u &lt;&lt; 0x1) &amp; ~(v &lt;&lt; 0x1)) + ~((~(u &lt;&lt; 0x1) &amp;</span>
<span class="sd">                   ~(v &lt;&lt; 0x1)) &lt;&lt; 0x1)) ^ (0x9 &amp; ~(u &lt;&lt; 0x1) &amp; ~(v &lt;&lt; 0x1))))) | (~(u &lt;&lt; 0x1) &amp; ~(v &lt;&lt; 0x1) &amp; (u ^ v)))</span>
<span class="sd">            &gt;&gt;&gt; result.xreplace({u: Constant(0, 4), v: Constant(0, 4)})</span>
<span class="sd">            0b1</span>

<span class="sd">        See `Derivative.is_possible` for more information.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_diff</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">val</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">output_diff</span><span class="o">.</span><span class="n">val</span>
        <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op</span><span class="o">.</span><span class="n">constant</span>

        <span class="n">effective_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_effective_width</span>
        <span class="n">index_one</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_first_one</span>

        <span class="k">if</span> <span class="n">effective_width</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">operation</span><span class="o">.</span><span class="n">BvComp</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">effective_width</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">operation</span><span class="o">.</span><span class="n">BvComp</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="n">index_one</span><span class="p">:],</span> <span class="n">v</span><span class="p">[</span><span class="n">index_one</span><span class="p">:])</span> <span class="o">&amp;</span> \
                   <span class="n">operation</span><span class="o">.</span><span class="n">BvComp</span><span class="p">(</span><span class="o">~</span><span class="n">u</span><span class="p">[</span><span class="n">index_one</span><span class="p">]</span> <span class="o">^</span> <span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="n">index_one</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">^</span> <span class="n">v</span><span class="p">[</span><span class="n">index_one</span><span class="o">+</span><span class="mi">1</span><span class="p">]),</span> <span class="n">core</span><span class="o">.</span><span class="n">Constant</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">index_one</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">Constant</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">operation</span><span class="o">.</span><span class="n">BvComp</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="n">index_one</span><span class="o">-</span><span class="mi">1</span><span class="p">:],</span> <span class="n">v</span><span class="p">[</span><span class="n">index_one</span><span class="o">-</span><span class="mi">1</span><span class="p">:])</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">difference</span><span class="o">.</span><span class="n">XorDiff</span><span class="p">(</span><span class="n">u</span><span class="p">[:</span><span class="n">index_one</span><span class="p">])</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">difference</span><span class="o">.</span><span class="n">XorDiff</span><span class="p">(</span><span class="n">v</span><span class="p">[:</span><span class="n">index_one</span><span class="p">])</span>
            <span class="n">der</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)([</span><span class="n">u</span><span class="p">],</span> <span class="n">a</span><span class="p">[:</span><span class="n">index_one</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">c</span> <span class="o">&amp;</span> <span class="n">der</span><span class="o">.</span><span class="n">_is_possible</span><span class="p">(</span><span class="n">v</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_has_probability_one</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_diff</span><span class="p">):</span>
        <span class="n">u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_diff</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">val</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">output_diff</span><span class="o">.</span><span class="n">val</span>
        <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op</span><span class="o">.</span><span class="n">constant</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">width</span>

        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_effective_width</span> <span class="o">==</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="n">one</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">Constant</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">all_ones</span><span class="p">(</span><span class="n">width</span><span class="p">):</span>
            <span class="k">return</span> <span class="o">~</span> <span class="n">core</span><span class="o">.</span><span class="n">Constant</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>

        <span class="n">case00_</span> <span class="o">=</span> <span class="p">(</span><span class="o">~</span><span class="p">(</span><span class="n">u</span> <span class="o">&lt;&lt;</span> <span class="n">one</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="p">(</span><span class="n">v</span> <span class="o">&lt;&lt;</span> <span class="n">one</span><span class="p">))</span>  <span class="c1"># i-bit is True if S_i = 00*</span>
        <span class="n">case__1</span> <span class="o">=</span> <span class="n">u</span> <span class="o">^</span> <span class="n">v</span>
        <span class="n">case000</span> <span class="o">=</span> <span class="n">case00_</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">case__1</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">operation</span><span class="o">.</span><span class="n">BvComp</span><span class="p">(</span><span class="n">case000</span><span class="p">,</span> <span class="n">all_ones</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>

<div class="viewcode-block" id="XDCA.has_probability_one"><a class="viewcode-back" href="../../../arxpy.differential.derivative.html#arxpy.differential.derivative.XDCA.has_probability_one">[docs]</a>    <span class="k">def</span> <span class="nf">has_probability_one</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_diff</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return whether the input diff propagates to the output diff with probability one.</span>

<span class="sd">            &gt;&gt;&gt; from arxpy.bitvector.core import Constant, Variable</span>
<span class="sd">            &gt;&gt;&gt; from arxpy.differential.difference import XorDiff</span>
<span class="sd">            &gt;&gt;&gt; from arxpy.differential.derivative import XDCA</span>
<span class="sd">            &gt;&gt;&gt; alpha, cte = XorDiff(Constant(0, 4)), Constant(1, 4)</span>
<span class="sd">            &gt;&gt;&gt; f = XDCA(alpha, cte)</span>
<span class="sd">            &gt;&gt;&gt; f.has_probability_one(XorDiff(Constant(0, 4)))</span>
<span class="sd">            0b1</span>
<span class="sd">            &gt;&gt;&gt; u, v = Variable(&quot;u&quot;, 4), Variable(&quot;v&quot;, 4)</span>
<span class="sd">            &gt;&gt;&gt; f = XDCA(XorDiff(u), cte)</span>
<span class="sd">            &gt;&gt;&gt; result = f.has_probability_one(XorDiff(v))</span>
<span class="sd">            &gt;&gt;&gt; result</span>
<span class="sd">            0xf == (~(u &lt;&lt; 0x1) &amp; ~(v &lt;&lt; 0x1) &amp; ~(u ^ v))</span>
<span class="sd">            &gt;&gt;&gt; result.xreplace({u: Constant(0, 4), v: Constant(0, 4)})</span>
<span class="sd">            0b1</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_diff</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">val</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">output_diff</span><span class="o">.</span><span class="n">val</span>
        <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op</span><span class="o">.</span><span class="n">constant</span>

        <span class="n">effective_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_effective_width</span>
        <span class="n">index_one</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_first_one</span>

        <span class="k">if</span> <span class="n">effective_width</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">operation</span><span class="o">.</span><span class="n">BvComp</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">effective_width</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">operation</span><span class="o">.</span><span class="n">BvComp</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="n">index_one</span><span class="p">:],</span> <span class="n">v</span><span class="p">[</span><span class="n">index_one</span><span class="p">:])</span> <span class="o">&amp;</span> \
                   <span class="n">operation</span><span class="o">.</span><span class="n">BvComp</span><span class="p">(</span><span class="o">~</span><span class="n">u</span><span class="p">[</span><span class="n">index_one</span><span class="p">]</span> <span class="o">^</span> <span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="n">index_one</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">^</span> <span class="n">v</span><span class="p">[</span><span class="n">index_one</span><span class="o">+</span><span class="mi">1</span><span class="p">]),</span> <span class="n">core</span><span class="o">.</span><span class="n">Constant</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">index_one</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">Constant</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">operation</span><span class="o">.</span><span class="n">BvComp</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="n">index_one</span><span class="o">-</span><span class="mi">1</span><span class="p">:],</span> <span class="n">v</span><span class="p">[</span><span class="n">index_one</span><span class="o">-</span><span class="mi">1</span><span class="p">:])</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">difference</span><span class="o">.</span><span class="n">XorDiff</span><span class="p">(</span><span class="n">u</span><span class="p">[:</span><span class="n">index_one</span><span class="p">])</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">difference</span><span class="o">.</span><span class="n">XorDiff</span><span class="p">(</span><span class="n">v</span><span class="p">[:</span><span class="n">index_one</span><span class="p">])</span>
            <span class="n">der</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)([</span><span class="n">u</span><span class="p">],</span> <span class="n">a</span><span class="p">[:</span><span class="n">index_one</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">c</span> <span class="o">&amp;</span> <span class="n">der</span><span class="o">.</span><span class="n">_has_probability_one</span><span class="p">(</span><span class="n">v</span><span class="p">)</span></div>

    <span class="c1"># noinspection SpellCheckingInspection</span>
<div class="viewcode-block" id="XDCA.weight"><a class="viewcode-back" href="../../../arxpy.differential.derivative.html#arxpy.differential.derivative.XDCA.weight">[docs]</a>    <span class="k">def</span> <span class="nf">weight</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_diff</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the weight of a possible output `XorDiff`.</span>

<span class="sd">        If the output difference is symbolic, a pair</span>
<span class="sd">        ``(weight, assertions)`` is returned, where ``assertions`` is</span>
<span class="sd">        a tuple of equalities fixing some temporary variables.</span>
<span class="sd">        If the output difference is a constant value,</span>
<span class="sd">        only the value of the weight is returned.</span>

<span class="sd">            &gt;&gt;&gt; from arxpy.bitvector.core import Constant, Variable</span>
<span class="sd">            &gt;&gt;&gt; from arxpy.bitvector.context import NotEvaluation</span>
<span class="sd">            &gt;&gt;&gt; from arxpy.bitvector.printing import BvWrapPrinter</span>
<span class="sd">            &gt;&gt;&gt; from arxpy.bitvector.extraop import PopCount, PopCountSum2, PopCountSum3, PopCountDiff, Reverse, LeadingZeros</span>
<span class="sd">            &gt;&gt;&gt; from arxpy.differential.difference import XorDiff</span>
<span class="sd">            &gt;&gt;&gt; from arxpy.differential.derivative import XDCA</span>
<span class="sd">            &gt;&gt;&gt; alpha, cte = XorDiff(Constant(0, 4)), Constant(1, 4)</span>
<span class="sd">            &gt;&gt;&gt; f = XDCA(alpha, cte)</span>
<span class="sd">            &gt;&gt;&gt; f.weight(XorDiff(Constant(0, 4)))</span>
<span class="sd">            0x0</span>
<span class="sd">            &gt;&gt;&gt; alpha = XorDiff(Variable(&quot;u&quot;, 4))</span>
<span class="sd">            &gt;&gt;&gt; f = XDCA(alpha, cte)</span>
<span class="sd">            &gt;&gt;&gt; beta = XorDiff(Variable(&quot;v&quot;, 4))</span>
<span class="sd">            &gt;&gt;&gt; with NotEvaluation([Reverse, PopCount, PopCountDiff, PopCountSum2, PopCountSum3, LeadingZeros]):</span>
<span class="sd">            ...     weight_value, assertions = f.weight(beta, prefix=&quot;&quot;)</span>
<span class="sd">            &gt;&gt;&gt; print(BvWrapPrinter().doprint(weight_value))</span>
<span class="sd">            -(::(PopCountDiff((~_0lz &amp; ((~u &amp; ~v) &lt;&lt; 0x1)) | ((u ^ v) &lt;&lt; 0x1),</span>
<span class="sd">                              (_1rev &amp; _4rev) ^ (0x1 + _1rev) ^ (0x1 + _1rev + (_1rev &amp; _4rev)),</span>
<span class="sd">                 0b0,</span>
<span class="sd">              ::(0b0,</span>
<span class="sd">                 PopCount(&amp;(_4rev &amp; ((_1rev &amp; _4rev) ^ (0x1 + _1rev) ^ (0x1 + _1rev + (_1rev &amp; _4rev))),</span>
<span class="sd">                            ~(((_1rev &amp; _4rev) ^ (0x1 + _1rev) ^ (0x1 + _1rev + (_1rev &amp; _4rev))) &lt;&lt; 0x1)</span>
<span class="sd">            &gt;&gt;&gt; assertions  # doctest: +NORMALIZE_WHITESPACE</span>
<span class="sd">            [_0lz == LeadingZeros(~((~u &amp; ~v) &lt;&lt; 0x1)),</span>
<span class="sd">            _1rev == Reverse((~u &amp; ~v) &lt;&lt; 0x1),</span>
<span class="sd">            _2rev == Reverse(~(((~u &amp; ~v) &lt;&lt; 0x1) &gt;&gt; 0x1) &amp; ((~u &amp; ~v) &lt;&lt; 0x1) &amp; (~(0x2 ^ u ^ v) &gt;&gt; 0x1)),</span>
<span class="sd">            _3rev == Reverse(_2rev ^ _1rev ^ (_1rev + _2rev)),</span>
<span class="sd">            _4rev == Reverse((((0x1 &amp; (((~u &amp; ~v) &lt;&lt; 0x1) &gt;&gt; 0x1)) + (0x2 &amp; (((~u &amp; ~v) &lt;&lt; 0x1) &gt;&gt; 0x1) &amp; ~((~u &amp; ~v) &lt;&lt; 0x1))) &amp; ~(_3rev | (~(((~u &amp; ~v) &lt;&lt; 0x1) &gt;&gt; 0x1) &amp; ((~u &amp; ~v) &lt;&lt; 0x1) &amp; (~(0x2 ^ u ^ v) &gt;&gt; 0x1)))) | ((~(((~u &amp; ~v) &lt;&lt; 0x1) &gt;&gt; 0x1) &amp; ((~u &amp; ~v) &lt;&lt; 0x1) &amp; (~(0x2 ^ u ^ v) &gt;&gt; 0x1)) - (((0x1 &amp; (((~u &amp; ~v) &lt;&lt; 0x1) &gt;&gt; 0x1)) + (0x2 &amp; (((~u &amp; ~v) &lt;&lt; 0x1) &gt;&gt; 0x1) &amp; ~((~u &amp; ~v) &lt;&lt; 0x1))) &amp; (_3rev | (~(((~u &amp; ~v) &lt;&lt; 0x1) &gt;&gt; 0x1) &amp; ((~u &amp; ~v) &lt;&lt; 0x1) &amp; (~(0x2 ^ u ^ v) &gt;&gt; 0x1))))))]</span>


<span class="sd">        See `Derivative.weight` for more information.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_diff</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">val</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">output_diff</span><span class="o">.</span><span class="n">val</span>
        <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op</span><span class="o">.</span><span class="n">constant</span>

        <span class="n">effective_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_effective_width</span>
        <span class="n">index_one</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_first_one</span>

        <span class="k">if</span> <span class="n">effective_width</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">core</span><span class="o">.</span><span class="n">Constant</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">difference</span><span class="o">.</span><span class="n">XorDiff</span><span class="p">(</span><span class="n">u</span><span class="p">[:</span><span class="n">index_one</span><span class="p">])</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">difference</span><span class="o">.</span><span class="n">XorDiff</span><span class="p">(</span><span class="n">v</span><span class="p">[:</span><span class="n">index_one</span><span class="p">])</span>
            <span class="n">der</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)([</span><span class="n">u</span><span class="p">],</span> <span class="n">a</span><span class="p">[:</span><span class="n">index_one</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">der</span><span class="o">.</span><span class="n">_weight</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">debug</span><span class="p">,</span> <span class="n">version</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_weight</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_diff</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
        <span class="n">u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_diff</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">val</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">output_diff</span><span class="o">.</span><span class="n">val</span>
        <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op</span><span class="o">.</span><span class="n">constant</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">width</span>
        <span class="n">one</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">Constant</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>

        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_effective_width</span> <span class="o">==</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="k">assert</span> <span class="n">version</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>  <span class="c1"># 0-reference, 1-w/o extra reverse, 2-s_000 and no HW2 in fr</span>

        <span class="k">if</span> <span class="n">prefix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;tmp&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="nb">hash</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">+</span> <span class="nb">hash</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">+</span> <span class="nb">hash</span><span class="p">(</span><span class="n">a</span><span class="p">)))</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">core</span><span class="o">.</span><span class="n">Constant</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">core</span><span class="o">.</span><span class="n">Constant</span><span class="p">):</span>
            <span class="n">are_cte_differences</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_i_auxvar</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">assertions</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">are_cte_differences</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">def</span> <span class="nf">rev</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">are_cte_differences</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">extraop</span><span class="o">.</span><span class="n">Reverse</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">aux</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">_</span><span class="si">{}</span><span class="s2">rev&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_i_auxvar</span><span class="p">),</span> <span class="n">x</span><span class="o">.</span><span class="n">width</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_i_auxvar</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">assertions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">operation</span><span class="o">.</span><span class="n">BvComp</span><span class="p">(</span><span class="n">aux</span><span class="p">,</span> <span class="n">extraop</span><span class="o">.</span><span class="n">Reverse</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
                <span class="k">return</span> <span class="n">aux</span>

        <span class="k">def</span> <span class="nf">lz</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">are_cte_differences</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">extraop</span><span class="o">.</span><span class="n">LeadingZeros</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">aux</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">_</span><span class="si">{}</span><span class="s2">lz&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_i_auxvar</span><span class="p">),</span> <span class="n">x</span><span class="o">.</span><span class="n">width</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_i_auxvar</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">assertions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">operation</span><span class="o">.</span><span class="n">BvComp</span><span class="p">(</span><span class="n">aux</span><span class="p">,</span> <span class="n">extraop</span><span class="o">.</span><span class="n">LeadingZeros</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
                <span class="k">return</span> <span class="n">aux</span>

        <span class="k">def</span> <span class="nf">carry</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">)</span> <span class="o">^</span> <span class="n">x</span> <span class="o">^</span> <span class="n">y</span>

        <span class="k">def</span> <span class="nf">rev_carry</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">rev</span><span class="p">(</span><span class="n">carry</span><span class="p">(</span><span class="n">rev</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">rev</span><span class="p">(</span><span class="n">y</span><span class="p">)))</span>

        <span class="k">if</span> <span class="n">version</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]:</span>
            <span class="n">s00_old</span> <span class="o">=</span> <span class="p">(</span><span class="o">~</span><span class="p">(</span><span class="n">u</span> <span class="o">&lt;&lt;</span> <span class="n">one</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="p">(</span><span class="n">v</span> <span class="o">&lt;&lt;</span> <span class="n">one</span><span class="p">))</span>  <span class="c1"># i-bit is True if S_{i} = 00*</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">s00_old</span> <span class="o">=</span> <span class="p">((</span><span class="o">~</span><span class="n">u</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">v</span><span class="p">))</span> <span class="o">&lt;&lt;</span> <span class="n">one</span>
        <span class="n">s00_</span> <span class="o">=</span> <span class="n">s00_old</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">lz</span><span class="p">(</span><span class="o">~</span><span class="n">s00_old</span><span class="p">))</span>  <span class="c1"># if x is 001*...*, then lz(x) = 1100...0</span>

        <span class="k">if</span> <span class="n">version</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">e_i1</span> <span class="o">=</span> <span class="n">s00_</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span> <span class="p">(</span><span class="n">s00_</span> <span class="o">&gt;&gt;</span> <span class="n">one</span><span class="p">))</span>  <span class="c1"># e_{i-1}</span>
            <span class="n">e_ili</span> <span class="o">=</span> <span class="o">~</span><span class="n">s00_</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">s00_</span> <span class="o">&gt;&gt;</span> <span class="n">one</span><span class="p">)</span>  <span class="c1"># e_{i-l_i}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">e_i1</span> <span class="o">=</span> <span class="n">s00_old</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span> <span class="p">(</span><span class="n">s00_old</span> <span class="o">&gt;&gt;</span> <span class="n">one</span><span class="p">))</span>  <span class="c1"># e_{i-1}</span>
            <span class="n">e_ili</span> <span class="o">=</span> <span class="o">~</span><span class="n">s00_old</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">s00_old</span> <span class="o">&gt;&gt;</span> <span class="n">one</span><span class="p">)</span>  <span class="c1"># e_{i-l_i}</span>

        <span class="n">q</span> <span class="o">=</span> <span class="o">~</span><span class="p">(</span> <span class="p">(</span><span class="n">a</span> <span class="o">&lt;&lt;</span> <span class="n">one</span><span class="p">)</span> <span class="o">^</span> <span class="p">(</span><span class="n">u</span> <span class="o">^</span> <span class="n">v</span><span class="p">)</span> <span class="p">)</span>  <span class="c1"># q[i] = ~(a[i-1]^u[i]^v[i])</span>
        <span class="n">q</span> <span class="o">=</span> <span class="p">((</span><span class="n">q</span> <span class="o">&gt;&gt;</span> <span class="n">one</span> <span class="p">)</span> <span class="o">&amp;</span> <span class="n">e_i1</span><span class="p">)</span>  <span class="c1"># q[i-1, i-3] = (a[i-1]^u[i]^v[i], 0, 0)</span>

        <span class="k">if</span> <span class="n">version</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="p">((</span><span class="n">a</span> <span class="o">&lt;&lt;</span> <span class="n">one</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">e_ili</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">a</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">s00_</span> <span class="o">&gt;&gt;</span> <span class="n">one</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="p">((</span><span class="n">a</span> <span class="o">&lt;&lt;</span> <span class="n">one</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">e_ili</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">a</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">s00_old</span> <span class="o">&gt;&gt;</span> <span class="n">one</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">version</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">rev_carry</span><span class="p">(</span><span class="n">s00_</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span> <span class="o">|</span> <span class="n">q</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rev_s00_old</span> <span class="o">=</span> <span class="n">rev</span><span class="p">(</span><span class="n">s00_old</span><span class="p">)</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">rev</span><span class="p">(</span><span class="n">carry</span><span class="p">(</span><span class="n">rev_s00_old</span><span class="p">,</span> <span class="n">rev</span><span class="p">(</span><span class="n">q</span><span class="p">)))</span> <span class="o">|</span> <span class="n">q</span>

        <span class="n">w</span> <span class="o">=</span> <span class="p">(</span><span class="n">q</span> <span class="o">-</span> <span class="p">(</span><span class="n">s</span> <span class="o">&amp;</span> <span class="n">d</span><span class="p">))</span> <span class="o">|</span> <span class="p">(</span><span class="n">s</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">d</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">version</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">w</span> <span class="o">&lt;&lt;</span> <span class="n">one</span>
            <span class="n">h</span> <span class="o">=</span> <span class="n">rev_carry</span><span class="p">(</span><span class="n">s00_</span> <span class="o">&lt;&lt;</span> <span class="n">one</span><span class="p">,</span> <span class="n">w</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">s00_</span> <span class="o">&lt;&lt;</span> <span class="n">one</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">version</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">rev_w</span> <span class="o">=</span> <span class="n">rev</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">one</span>
            <span class="n">rev_h</span> <span class="o">=</span> <span class="n">carry</span><span class="p">(</span> <span class="p">(</span><span class="n">rev_s00_old</span> <span class="o">+</span> <span class="n">one</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">one</span><span class="p">,</span> <span class="n">rev_w</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">rev</span><span class="p">(</span><span class="n">s00_</span><span class="p">))</span> <span class="o">&gt;&gt;</span> <span class="n">one</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rev_w</span> <span class="o">=</span> <span class="n">rev</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
            <span class="n">rev_h</span> <span class="o">=</span> <span class="n">carry</span><span class="p">(</span><span class="n">rev_s00_old</span> <span class="o">+</span> <span class="n">one</span><span class="p">,</span> <span class="n">rev_w</span> <span class="o">&amp;</span> <span class="n">rev_s00_old</span><span class="p">)</span>

        <span class="n">sbnegb</span> <span class="o">=</span> <span class="p">(</span><span class="n">u</span> <span class="o">^</span> <span class="n">v</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">one</span>  <span class="c1"># i-bit is True if S_{i} = (b, \neg b, *)</span>

        <span class="k">if</span> <span class="n">version</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">int</span> <span class="o">=</span> <span class="n">extraop</span><span class="o">.</span><span class="n">PopCountDiff</span><span class="p">(</span><span class="n">sbnegb</span> <span class="o">|</span> <span class="n">s00_</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>   <span class="c1"># or hw(sbminb_) + (hw(s00_) - hw(h))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">int</span> <span class="o">=</span> <span class="n">extraop</span><span class="o">.</span><span class="n">PopCountDiff</span><span class="p">(</span><span class="n">sbnegb</span> <span class="o">|</span> <span class="n">s00_</span><span class="p">,</span> <span class="n">rev_h</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">smart_add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">width</span> <span class="o">==</span> <span class="n">y</span><span class="o">.</span><span class="n">width</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
            <span class="k">elif</span> <span class="n">x</span><span class="o">.</span><span class="n">width</span> <span class="o">&lt;</span> <span class="n">y</span><span class="o">.</span><span class="n">width</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">operation</span><span class="o">.</span><span class="n">ZeroExtend</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">width</span><span class="p">)</span> <span class="o">+</span> <span class="n">y</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">operation</span><span class="o">.</span><span class="n">ZeroExtend</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="n">y</span><span class="o">.</span><span class="n">width</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">smart_sub</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
            <span class="c1"># cannot be replaced by smart_add(x, -y)</span>
            <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">width</span> <span class="o">==</span> <span class="n">y</span><span class="o">.</span><span class="n">width</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">x</span> <span class="o">-</span> <span class="n">y</span>
            <span class="k">elif</span> <span class="n">x</span><span class="o">.</span><span class="n">width</span> <span class="o">&lt;</span> <span class="n">y</span><span class="o">.</span><span class="n">width</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">operation</span><span class="o">.</span><span class="n">ZeroExtend</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">width</span><span class="p">)</span> <span class="o">-</span> <span class="n">y</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">x</span> <span class="o">-</span> <span class="n">operation</span><span class="o">.</span><span class="n">ZeroExtend</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="n">y</span><span class="o">.</span><span class="n">width</span><span class="p">)</span>

        <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_effective_precision</span>

        <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">int_frac</span> <span class="o">=</span> <span class="nb">int</span>
        <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">int</span> <span class="o">=</span> <span class="n">operation</span><span class="o">.</span><span class="n">Concat</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">core</span><span class="o">.</span><span class="n">Constant</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">version</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">f1</span> <span class="o">=</span> <span class="n">extraop</span><span class="o">.</span><span class="n">PopCount</span><span class="p">(</span><span class="n">w</span> <span class="o">&amp;</span> <span class="n">h</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="p">(</span><span class="n">h</span> <span class="o">&gt;&gt;</span> <span class="n">one</span><span class="p">)))</span>  <span class="c1"># each one adds 2^(-1)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">f1</span> <span class="o">=</span> <span class="n">extraop</span><span class="o">.</span><span class="n">PopCount</span><span class="p">(</span><span class="n">rev_w</span> <span class="o">&amp;</span> <span class="n">rev_h</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="p">(</span><span class="n">rev_h</span> <span class="o">&lt;&lt;</span> <span class="n">one</span><span class="p">)))</span>
            <span class="n">int_frac</span> <span class="o">=</span> <span class="n">smart_sub</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">f1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">two</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">Constant</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
            <span class="n">three</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">Constant</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
            <span class="n">four</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">Constant</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">version</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">f12</span> <span class="o">=</span> <span class="n">extraop</span><span class="o">.</span><span class="n">PopCountSum2</span><span class="p">(</span>
                    <span class="n">w</span> <span class="o">&amp;</span> <span class="n">h</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="p">(</span><span class="n">h</span> <span class="o">&gt;&gt;</span> <span class="n">one</span><span class="p">)),</span>
                    <span class="n">w</span> <span class="o">&amp;</span> <span class="n">h</span> <span class="o">&amp;</span> <span class="p">((</span><span class="o">~</span><span class="p">(</span><span class="n">h</span> <span class="o">&gt;&gt;</span> <span class="n">one</span><span class="p">))</span> <span class="o">|</span> <span class="p">(</span><span class="o">~</span><span class="p">(</span><span class="n">h</span> <span class="o">&gt;&gt;</span> <span class="n">two</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">h</span> <span class="o">&gt;&gt;</span> <span class="n">one</span><span class="p">))</span>
                <span class="p">)</span>  <span class="c1"># each one adds 2^(-2), that&#39;s why ~(h &gt;&gt; one) need to be counted twice</span>
            <span class="k">elif</span> <span class="n">version</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">f12</span> <span class="o">=</span> <span class="n">extraop</span><span class="o">.</span><span class="n">PopCountSum2</span><span class="p">(</span>
                    <span class="n">rev_w</span> <span class="o">&amp;</span> <span class="n">rev_h</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="p">(</span><span class="n">rev_h</span> <span class="o">&lt;&lt;</span> <span class="n">one</span><span class="p">)),</span>
                    <span class="n">rev_w</span> <span class="o">&amp;</span> <span class="n">rev_h</span> <span class="o">&amp;</span> <span class="p">((</span><span class="o">~</span><span class="p">(</span><span class="n">rev_h</span> <span class="o">&lt;&lt;</span> <span class="n">one</span><span class="p">))</span> <span class="o">|</span> <span class="p">(</span><span class="o">~</span><span class="p">(</span><span class="n">rev_h</span> <span class="o">&lt;&lt;</span> <span class="n">two</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">rev_h</span> <span class="o">&lt;&lt;</span> <span class="n">one</span><span class="p">))</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">f12</span> <span class="o">=</span> <span class="n">extraop</span><span class="o">.</span><span class="n">PopCount</span><span class="p">(</span>
                    <span class="c1"># ( ( rev_w &amp; rev_h &amp; (~(rev_h &lt;&lt; one)) ) &gt;&gt; one ) |</span>
                    <span class="p">(</span> <span class="p">(</span> <span class="p">(</span><span class="n">rev_w</span> <span class="o">&amp;</span> <span class="n">rev_h</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">one</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">rev_h</span><span class="p">)</span>  <span class="p">)</span> <span class="o">|</span>
                    <span class="p">(</span><span class="n">rev_w</span> <span class="o">&amp;</span> <span class="n">rev_h</span> <span class="o">&amp;</span> <span class="p">((</span><span class="o">~</span><span class="p">(</span><span class="n">rev_h</span> <span class="o">&lt;&lt;</span> <span class="n">one</span><span class="p">))</span> <span class="o">|</span> <span class="p">(</span><span class="o">~</span><span class="p">(</span><span class="n">rev_h</span> <span class="o">&lt;&lt;</span> <span class="n">two</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">rev_h</span> <span class="o">&lt;&lt;</span> <span class="n">one</span><span class="p">)))</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="nb">int</span> <span class="o">=</span> <span class="n">operation</span><span class="o">.</span><span class="n">Concat</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">core</span><span class="o">.</span><span class="n">Constant</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
                <span class="n">int_frac</span> <span class="o">=</span> <span class="n">smart_sub</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">f12</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="c1"># f3 cannot be included in f12, since ~(h &gt;&gt; one) would need to be counted 4 times</span>
                <span class="k">if</span> <span class="n">version</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">f3</span> <span class="o">=</span> <span class="n">extraop</span><span class="o">.</span><span class="n">PopCount</span><span class="p">(</span><span class="n">w</span> <span class="o">&amp;</span> <span class="n">h</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">h</span> <span class="o">&gt;&gt;</span> <span class="n">one</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">h</span> <span class="o">&gt;&gt;</span> <span class="n">two</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="p">(</span><span class="n">h</span> <span class="o">&gt;&gt;</span> <span class="n">three</span><span class="p">)))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">f3</span> <span class="o">=</span> <span class="n">extraop</span><span class="o">.</span><span class="n">PopCount</span><span class="p">(</span><span class="n">rev_w</span> <span class="o">&amp;</span> <span class="n">rev_h</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">rev_h</span> <span class="o">&lt;&lt;</span> <span class="n">one</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">rev_h</span> <span class="o">&lt;&lt;</span> <span class="n">two</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="p">(</span><span class="n">rev_h</span> <span class="o">&lt;&lt;</span> <span class="n">three</span><span class="p">)))</span>
                <span class="nb">int</span> <span class="o">=</span> <span class="n">operation</span><span class="o">.</span><span class="n">Concat</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">core</span><span class="o">.</span><span class="n">Constant</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
                <span class="n">f12</span> <span class="o">=</span> <span class="n">operation</span><span class="o">.</span><span class="n">Concat</span><span class="p">(</span><span class="n">f12</span><span class="p">,</span> <span class="n">core</span><span class="o">.</span><span class="n">Constant</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
                <span class="n">int_frac</span> <span class="o">=</span> <span class="n">smart_sub</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">smart_add</span><span class="p">(</span><span class="n">f12</span><span class="p">,</span> <span class="n">f3</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">version</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">f34</span> <span class="o">=</span> <span class="n">extraop</span><span class="o">.</span><span class="n">PopCountSum2</span><span class="p">(</span>
                        <span class="n">w</span> <span class="o">&amp;</span> <span class="n">h</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">h</span> <span class="o">&gt;&gt;</span> <span class="n">one</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">h</span> <span class="o">&gt;&gt;</span> <span class="n">two</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="p">(</span><span class="n">h</span> <span class="o">&gt;&gt;</span> <span class="n">three</span><span class="p">)),</span>
                        <span class="n">w</span> <span class="o">&amp;</span> <span class="n">h</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">h</span> <span class="o">&gt;&gt;</span> <span class="n">one</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">h</span> <span class="o">&gt;&gt;</span> <span class="n">two</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">((</span><span class="o">~</span><span class="p">(</span><span class="n">h</span> <span class="o">&gt;&gt;</span> <span class="n">three</span><span class="p">))</span> <span class="o">|</span> <span class="p">(</span><span class="o">~</span><span class="p">(</span><span class="n">h</span> <span class="o">&gt;&gt;</span> <span class="n">four</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">h</span> <span class="o">&gt;&gt;</span> <span class="n">three</span><span class="p">)))</span>
                    <span class="p">)</span>
                <span class="k">elif</span> <span class="n">version</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">f34</span> <span class="o">=</span> <span class="n">extraop</span><span class="o">.</span><span class="n">PopCountSum2</span><span class="p">(</span>
                        <span class="n">rev_w</span> <span class="o">&amp;</span> <span class="n">rev_h</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">rev_h</span> <span class="o">&lt;&lt;</span> <span class="n">one</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">rev_h</span> <span class="o">&lt;&lt;</span> <span class="n">two</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="p">(</span><span class="n">rev_h</span> <span class="o">&lt;&lt;</span> <span class="n">three</span><span class="p">)),</span>
                        <span class="n">rev_w</span> <span class="o">&amp;</span> <span class="n">rev_h</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">rev_h</span> <span class="o">&lt;&lt;</span> <span class="n">one</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">rev_h</span> <span class="o">&lt;&lt;</span> <span class="n">two</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">((</span><span class="o">~</span><span class="p">(</span><span class="n">rev_h</span> <span class="o">&lt;&lt;</span> <span class="n">three</span><span class="p">))</span> <span class="o">|</span> <span class="p">(</span><span class="o">~</span><span class="p">(</span><span class="n">rev_h</span> <span class="o">&lt;&lt;</span> <span class="n">four</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">rev_h</span> <span class="o">&lt;&lt;</span> <span class="n">three</span><span class="p">)))</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">f34</span> <span class="o">=</span> <span class="n">extraop</span><span class="o">.</span><span class="n">PopCount</span><span class="p">(</span>
                        <span class="c1"># ( (rev_w &amp; rev_h &amp; (rev_h &lt;&lt; one) &amp; (rev_h &lt;&lt; two) &amp; (~(rev_h &lt;&lt; three))) &gt;&gt; one ) |</span>
                        <span class="p">(</span> <span class="p">((</span><span class="n">rev_w</span> <span class="o">&amp;</span> <span class="n">rev_h</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">one</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">rev_h</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">rev_h</span> <span class="o">&lt;&lt;</span> <span class="n">one</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="p">(</span><span class="n">rev_h</span> <span class="o">&lt;&lt;</span> <span class="n">two</span><span class="p">)))</span> <span class="o">|</span>
                        <span class="p">(</span><span class="n">rev_w</span> <span class="o">&amp;</span> <span class="n">rev_h</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">rev_h</span> <span class="o">&lt;&lt;</span> <span class="n">one</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">rev_h</span> <span class="o">&lt;&lt;</span> <span class="n">two</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">((</span><span class="o">~</span><span class="p">(</span><span class="n">rev_h</span> <span class="o">&lt;&lt;</span> <span class="n">three</span><span class="p">))</span> <span class="o">|</span> <span class="p">(</span><span class="o">~</span><span class="p">(</span><span class="n">rev_h</span> <span class="o">&lt;&lt;</span> <span class="n">four</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">rev_h</span> <span class="o">&lt;&lt;</span> <span class="n">three</span><span class="p">))))</span>
                    <span class="p">)</span>
                <span class="nb">int</span> <span class="o">=</span> <span class="n">operation</span><span class="o">.</span><span class="n">Concat</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">core</span><span class="o">.</span><span class="n">Constant</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
                <span class="n">f12</span> <span class="o">=</span> <span class="n">operation</span><span class="o">.</span><span class="n">Concat</span><span class="p">(</span><span class="n">f12</span><span class="p">,</span> <span class="n">core</span><span class="o">.</span><span class="n">Constant</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
                <span class="n">int_frac</span> <span class="o">=</span> <span class="n">smart_sub</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">smart_add</span><span class="p">(</span><span class="n">f12</span><span class="p">,</span> <span class="n">f34</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;precision must be between 0 and 4&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2"> ~~ &quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;u:            &quot;</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">bin</span><span class="p">())</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;v:            &quot;</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">bin</span><span class="p">())</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;a:            &quot;</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">bin</span><span class="p">())</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;s00_:         &quot;</span><span class="p">,</span> <span class="n">s00_</span><span class="o">.</span><span class="n">bin</span><span class="p">())</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e_i1:         &quot;</span><span class="p">,</span> <span class="n">e_i1</span><span class="o">.</span><span class="n">bin</span><span class="p">())</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e_ili1:       &quot;</span><span class="p">,</span> <span class="n">e_ili</span><span class="o">.</span><span class="n">bin</span><span class="p">())</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;q:            &quot;</span><span class="p">,</span> <span class="n">q</span><span class="o">.</span><span class="n">bin</span><span class="p">())</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;s:            &quot;</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">bin</span><span class="p">())</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;d:            &quot;</span><span class="p">,</span> <span class="n">d</span><span class="o">.</span><span class="n">bin</span><span class="p">())</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;w:            &quot;</span><span class="p">,</span> <span class="n">w</span><span class="o">.</span><span class="n">bin</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">version</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;h:            &quot;</span><span class="p">,</span> <span class="n">h</span><span class="o">.</span><span class="n">bin</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;rev_w:        &quot;</span><span class="p">,</span> <span class="n">rev_w</span><span class="o">.</span><span class="n">bin</span><span class="p">())</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;rev_h:        &quot;</span><span class="p">,</span> <span class="n">rev_h</span><span class="o">.</span><span class="n">bin</span><span class="p">())</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;sbnegb:       &quot;</span><span class="p">,</span> <span class="n">sbnegb</span><span class="o">.</span><span class="n">bin</span><span class="p">())</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;int:          &quot;</span><span class="p">,</span> <span class="nb">int</span><span class="o">.</span><span class="n">bin</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;f1:           &quot;</span><span class="p">,</span> <span class="n">f1</span><span class="o">.</span><span class="n">bin</span><span class="p">())</span>
            <span class="k">elif</span> <span class="n">k</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;f12:          &quot;</span><span class="p">,</span> <span class="n">f12</span><span class="o">.</span><span class="n">bin</span><span class="p">())</span>
                <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;f3:           &quot;</span><span class="p">,</span> <span class="n">f3</span><span class="o">.</span><span class="n">bin</span><span class="p">())</span>
                <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;f34:          &quot;</span><span class="p">,</span> <span class="n">f34</span><span class="o">.</span><span class="n">bin</span><span class="p">())</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;int_frac:     &quot;</span><span class="p">,</span> <span class="n">int_frac</span><span class="o">.</span><span class="n">bin</span><span class="p">())</span>

        <span class="k">if</span> <span class="n">are_cte_differences</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">int_frac</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">int_frac</span><span class="p">,</span> <span class="n">assertions</span>

<div class="viewcode-block" id="XDCA.max_weight"><a class="viewcode-back" href="../../../arxpy.differential.derivative.html#arxpy.differential.derivative.XDCA.max_weight">[docs]</a>    <span class="k">def</span> <span class="nf">max_weight</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">effective_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_effective_width</span>

        <span class="k">if</span> <span class="n">effective_width</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">effective_width</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="bp">self</span><span class="o">.</span><span class="n">_effective_precision</span><span class="p">)</span></div>

<div class="viewcode-block" id="XDCA.exact_weight"><a class="viewcode-back" href="../../../arxpy.differential.derivative.html#arxpy.differential.derivative.XDCA.exact_weight">[docs]</a>    <span class="k">def</span> <span class="nf">exact_weight</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_diff</span><span class="p">):</span>
        <span class="n">u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_diff</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">val</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">output_diff</span><span class="o">.</span><span class="n">val</span>
        <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op</span><span class="o">.</span><span class="n">constant</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">width</span>

        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">core</span><span class="o">.</span><span class="n">Constant</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">core</span><span class="o">.</span><span class="n">Constant</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">probability2weight</span><span class="p">(</span><span class="n">pr</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">pr</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">inf</span>
            <span class="k">elif</span> <span class="n">pr</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="mi">0</span>  <span class="c1"># avoid 0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">pr</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="k">return</span> <span class="n">probability2weight</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">probability</span> <span class="o">=</span> <span class="n">fractions</span><span class="o">.</span><span class="n">Fraction</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="n">fractions</span><span class="o">.</span><span class="n">Fraction</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">[</span><span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">^</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]]</span> <span class="o">==</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]:</span>
                <span class="n">delta</span> <span class="o">=</span> <span class="n">fractions</span><span class="o">.</span><span class="n">Fraction</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="n">delta</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

            <span class="k">if</span> <span class="p">[</span><span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">^</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]]</span> <span class="o">==</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]:</span>
                <span class="k">return</span> <span class="n">probability2weight</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

            <span class="k">if</span> <span class="p">[</span><span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">^</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]]</span> <span class="o">==</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]:</span>
                <span class="n">probability</span> <span class="o">*=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="n">delta</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">delta</span><span class="p">))</span>
                <span class="n">delta</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

            <span class="k">if</span> <span class="p">[</span><span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">^</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]]</span> <span class="o">==</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]:</span>
                <span class="n">probability</span> <span class="o">*=</span> <span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="n">delta</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">delta</span><span class="p">)</span>
                <span class="n">delta</span> <span class="o">=</span> <span class="n">fractions</span><span class="o">.</span><span class="n">Fraction</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

            <span class="k">if</span> <span class="p">[</span><span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">^</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]]</span> <span class="o">==</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]:</span>
                <span class="n">probability</span> <span class="o">*=</span> <span class="n">fractions</span><span class="o">.</span><span class="n">Fraction</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">delta</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

            <span class="k">if</span> <span class="p">[</span><span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">^</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]]</span> <span class="o">==</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]:</span>
                <span class="n">probability</span> <span class="o">*=</span> <span class="n">fractions</span><span class="o">.</span><span class="n">Fraction</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

            <span class="k">if</span> <span class="p">[</span><span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">^</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]]</span> <span class="o">==</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]:</span>
                <span class="n">probability</span> <span class="o">*=</span> <span class="n">fractions</span><span class="o">.</span><span class="n">Fraction</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">delta</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

            <span class="k">if</span> <span class="p">[</span><span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">^</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]]</span> <span class="o">==</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]:</span>
                <span class="n">probability</span> <span class="o">*=</span> <span class="n">fractions</span><span class="o">.</span><span class="n">Fraction</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">probability2weight</span><span class="p">(</span><span class="n">probability</span><span class="p">)</span></div>

<div class="viewcode-block" id="XDCA.num_frac_bits"><a class="viewcode-back" href="../../../arxpy.differential.derivative.html#arxpy.differential.derivative.XDCA.num_frac_bits">[docs]</a>    <span class="k">def</span> <span class="nf">num_frac_bits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_effective_precision</span></div>

    <span class="c1"># noinspection SpellCheckingInspection</span>
    <span class="nd">@classmethod</span>
    <span class="nd">@functools</span><span class="o">.</span><span class="n">lru_cache</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_len2error</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">precision</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a dictionary mapping difference lengths to their maximum error.</span>

<span class="sd">            &gt;&gt;&gt; # docstring for debugging purposes</span>
<span class="sd">            &gt;&gt;&gt; from arxpy.bitvector.core import Constant, Variable</span>
<span class="sd">            &gt;&gt;&gt; from arxpy.differential.difference import XorDiff</span>
<span class="sd">            &gt;&gt;&gt; from arxpy.differential.derivative import XDCA</span>
<span class="sd">            &gt;&gt;&gt; _ = XDCA._len2error(8, 4, True)</span>
<span class="sd">            chainlen2biterror: {3: 0.03, 5: 0.02}</span>
<span class="sd">            worst_chainlen: 3</span>
<span class="sd">            &lt;BLANKLINE&gt;</span>
<span class="sd">             &gt; difflen: 4</span>
<span class="sd">             &gt; decompositions: [[3]]</span>
<span class="sd">             &gt; worst_decomp: [3]</span>
<span class="sd">             &gt; difflen2differror[4]: 0.0860713320559343</span>
<span class="sd">             &gt; difflen: 5</span>
<span class="sd">             &gt; decompositions: [[5], [3]]</span>
<span class="sd">             &gt; worst_decomp: [5]</span>
<span class="sd">             &gt; difflen2differror[5]: 0.08607133205593431</span>
<span class="sd">             &gt; difflen: 7</span>
<span class="sd">             &gt; decompositions: [[3, 3], [3], [5]]</span>
<span class="sd">             &gt; worst_decomp: [3, 3]</span>
<span class="sd">             &gt; difflen2differror[7]: 0.1721426641118686</span>
<span class="sd">            &lt;BLANKLINE&gt;</span>
<span class="sd">            prime_lens: [3, 5]</span>
<span class="sd">            difflen2differror: [0, 0, 0, 0.09, 0.09, 0.09, 0.17, 0.17]</span>
<span class="sd">            &lt;BLANKLINE&gt;</span>
<span class="sd">            &gt;&gt;&gt; [round(d, 2) for d in XDCA._len2error(8, 0)]</span>
<span class="sd">            [0, 0, 0, 1.0, 1.0, 1.0, 2.0, 2.0]</span>
<span class="sd">            &gt;&gt;&gt; [round(d, 2) for d in XDCA._len2error(8, 1)]</span>
<span class="sd">            [0, 0, 0, 0.09, 0.58, 0.58, 0.58, 0.67]</span>
<span class="sd">            &gt;&gt;&gt; [round(d, 2) for d in XDCA._len2error(8, 2)]</span>
<span class="sd">            [0, 0, 0, 0.09, 0.09, 0.33, 0.33, 0.33]</span>
<span class="sd">            &gt;&gt;&gt; [round(d, 2) for d in XDCA._len2error(8, 3)]</span>
<span class="sd">            [0, 0, 0, 0.09, 0.09, 0.09, 0.21, 0.21]</span>
<span class="sd">            &gt;&gt;&gt; [round(d, 2) for d in XDCA._len2error(8, 4)]</span>
<span class="sd">            [0, 0, 0, 0.09, 0.09, 0.09, 0.17, 0.17]</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">n</span> <span class="o">&lt;=</span> <span class="mi">32</span>

        <span class="k">def</span> <span class="nf">get_chainlen2biterror</span><span class="p">():</span>
            <span class="k">def</span> <span class="nf">bit_error</span><span class="p">(</span><span class="n">chainlen</span><span class="p">):</span>
                <span class="c1"># given a chain of length l_i,</span>
                <span class="c1"># if pi != 2^{-i}, then p_i &lt;= 2^{l_i - 1} - 1</span>
                <span class="c1"># and there are (at most) l_i - 2 bits right to the leftmost active bit.</span>
                <span class="c1"># (e.g. l_i = 4, p_i &lt;= 7 = 0b111, two &quot;fraction bits&quot;)</span>
                <span class="n">k</span> <span class="o">=</span> <span class="n">precision</span>

                <span class="k">if</span> <span class="n">chainlen</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">&lt;=</span> <span class="n">k</span><span class="p">:</span>
                    <span class="c1"># 0.086... is the error when all fraction bits are sued</span>
                    <span class="k">return</span> <span class="mf">0.0860713320559343</span> <span class="o">/</span> <span class="n">chainlen</span>

                <span class="n">t</span> <span class="o">=</span> <span class="p">[</span><span class="n">t_i</span> <span class="o">*</span> <span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">t_i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">k</span><span class="p">)]</span>  <span class="c1"># t[i] = t_i * 2**(-k)</span>
                <span class="n">chainerror</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">t_i</span> <span class="o">+</span> <span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">k</span><span class="p">))</span> <span class="o">-</span> <span class="n">t_i</span> <span class="k">for</span> <span class="n">t_i</span> <span class="ow">in</span> <span class="n">t</span><span class="p">)</span>

                <span class="k">return</span> <span class="n">chainerror</span> <span class="o">/</span> <span class="n">chainlen</span>

            <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">worst_chainlen</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="n">worst_chainlen_error</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="k">for</span> <span class="n">chainlen</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
                <span class="c1"># chainlen = l_i</span>
                <span class="n">chainerror</span> <span class="o">=</span> <span class="n">bit_error</span><span class="p">(</span><span class="n">chainlen</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">chainerror</span> <span class="o">&gt;</span> <span class="n">worst_chainlen_error</span><span class="p">:</span>
                    <span class="n">worst_chainlen_error</span> <span class="o">=</span> <span class="n">chainerror</span>
                    <span class="n">worst_chainlen</span> <span class="o">=</span> <span class="n">chainlen</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">((</span><span class="n">chainlen</span> <span class="o">//</span> <span class="n">worst_chainlen</span><span class="p">)</span> <span class="o">*</span> <span class="n">worst_chainlen</span><span class="p">)</span> <span class="o">*</span> <span class="n">worst_chainlen_error</span> <span class="o">&gt;=</span> <span class="n">chainlen</span> <span class="o">*</span> <span class="n">chainerror</span><span class="p">:</span>
                        <span class="c1"># assume chainlen = worst_chainlen * k</span>
                        <span class="c1"># if error(worst_chainlen) * k) &gt;= error(chainlen), we ignore chainleb</span>
                        <span class="k">continue</span>

                <span class="n">d</span><span class="p">[</span><span class="n">chainlen</span><span class="p">]</span> <span class="o">=</span> <span class="n">chainerror</span>

            <span class="k">return</span> <span class="n">d</span>

        <span class="n">chainlen2biterror</span> <span class="o">=</span> <span class="n">get_chainlen2biterror</span><span class="p">()</span>

        <span class="n">worst_chainlen</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">chainlen2biterror</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="n">operator</span><span class="o">.</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">1</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">def</span> <span class="nf">error_chainlen</span><span class="p">(</span><span class="n">chainlen</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">chainlen2biterror</span><span class="p">[</span><span class="n">chainlen</span><span class="p">]</span> <span class="o">*</span> <span class="n">chainlen</span>

        <span class="k">def</span> <span class="nf">error_decomposition</span><span class="p">(</span><span class="n">decomposition</span><span class="p">):</span>
            <span class="n">error</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">chainlen</span> <span class="ow">in</span> <span class="n">decomposition</span><span class="p">:</span>
                <span class="n">error</span> <span class="o">+=</span> <span class="n">error_chainlen</span><span class="p">(</span><span class="n">chainlen</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">error</span>

        <span class="c1"># a prime length correspond to a single chain of maximum error</span>
        <span class="c1"># (decomposing the chain in sub-chains do not increase the error)</span>
        <span class="n">prime_lens</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">worst_chainlen</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">prime_lens</span><span class="p">:</span>
            <span class="n">prime_lens</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">worst_chainlen</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">get_decompositions</span><span class="p">(</span><span class="n">diff_len</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">diff_len</span> <span class="ow">in</span> <span class="n">prime_lens</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[[</span><span class="n">diff_len</span><span class="p">]]</span>  <span class="c1"># trivial decomposition</span>

            <span class="n">diff_decompositions</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">prime_lens</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">m</span> <span class="o">&lt;=</span> <span class="n">diff_len</span><span class="p">:</span>
                    <span class="n">m_decompositions</span> <span class="o">=</span> <span class="n">get_decompositions</span><span class="p">(</span><span class="n">diff_len</span> <span class="o">-</span> <span class="n">m</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">decomp</span> <span class="ow">in</span> <span class="n">m_decompositions</span><span class="p">:</span>
                        <span class="n">diff_decompositions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">sorted</span><span class="p">([</span><span class="n">m</span><span class="p">]</span> <span class="o">+</span> <span class="n">decomp</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">diff_decompositions</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">m</span><span class="p">])</span>

            <span class="k">return</span> <span class="n">diff_decompositions</span>

        <span class="n">difflen2differror</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span>
        <span class="n">difflen2differror</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">error_chainlen</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>

        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;chainlen2biterror:&quot;</span><span class="p">,</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">chainlen2biterror</span><span class="o">.</span><span class="n">items</span><span class="p">()})</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;worst_chainlen:&quot;</span><span class="p">,</span> <span class="n">worst_chainlen</span><span class="p">)</span>
            <span class="c1"># print(&quot;maxchain:&quot;, maxchain)</span>
            <span class="nb">print</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">difflen</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">difflen</span> <span class="o">%</span> <span class="n">worst_chainlen</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">difflen2differror</span><span class="p">[</span><span class="n">difflen</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">difflen</span> <span class="o">//</span> <span class="n">worst_chainlen</span><span class="p">)</span> <span class="o">*</span> <span class="n">error_chainlen</span><span class="p">(</span><span class="n">worst_chainlen</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="n">decompositions</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">if</span> <span class="n">difflen</span> <span class="ow">in</span> <span class="n">chainlen2biterror</span><span class="p">:</span>
                <span class="n">decompositions</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">difflen</span><span class="p">])</span>

            <span class="n">decompositions</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">get_decompositions</span><span class="p">(</span><span class="n">difflen</span><span class="p">))</span>
            <span class="n">worst_decomp</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">decompositions</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">error_decomposition</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">worst_decomp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">difflen</span><span class="p">:</span>
                <span class="n">prime_lens</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">difflen</span><span class="p">)</span>

            <span class="c1"># noinspection PyTypeChecker</span>
            <span class="n">difflen2differror</span><span class="p">[</span><span class="n">difflen</span><span class="p">]</span> <span class="o">=</span> <span class="n">error_decomposition</span><span class="p">(</span><span class="n">worst_decomp</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; &gt; difflen:&quot;</span><span class="p">,</span> <span class="n">difflen</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; &gt; decompositions:&quot;</span><span class="p">,</span> <span class="n">decompositions</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; &gt; worst_decomp:&quot;</span><span class="p">,</span> <span class="n">worst_decomp</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; &gt; difflen2differror[</span><span class="si">{}</span><span class="s2">]: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">difflen</span><span class="p">,</span> <span class="n">difflen2differror</span><span class="p">[</span><span class="n">difflen</span><span class="p">]))</span>

        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">prime_lens:&quot;</span><span class="p">,</span> <span class="n">prime_lens</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;difflen2differror:&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">difflen2differror</span><span class="p">])</span>
            <span class="nb">print</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">difflen2differror</span>

<div class="viewcode-block" id="XDCA.error"><a class="viewcode-back" href="../../../arxpy.differential.derivative.html#arxpy.differential.derivative.XDCA.error">[docs]</a>    <span class="k">def</span> <span class="nf">error</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op</span><span class="o">.</span><span class="n">constant</span><span class="o">.</span><span class="n">width</span>
        <span class="n">effective_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_effective_width</span>

        <span class="n">len2error</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_len2error</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_effective_precision</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">effective_width</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">len2error</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">len2error</span><span class="p">[</span><span class="n">effective_width</span><span class="p">]</span></div>

    <span class="k">def</span> <span class="nf">_replace_input_diff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_input_diff</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_replace_input_diff</span><span class="p">(</span><span class="n">new_input_diff</span><span class="p">,</span> <span class="n">cte</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">op</span><span class="o">.</span><span class="n">constant</span><span class="p">)</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Adrian Ranea

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>